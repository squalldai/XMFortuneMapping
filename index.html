<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v2.0</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  header {
    background: linear-gradient(135deg,#ffecd2,#fcb69f);
    height: 15vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    font-weight: bold;
    color: #333;
  }

  .container {
    max-width: 480px;
    margin: 10px auto;
    padding: 20px;
    background: #fff;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .description {
    font-size: 0.85rem;
    color: #555;
    font-style: italic;
    background: #f8f8f8;
    padding: 8px;
    border-radius: 6px;
  }

  .radio-group {
    display: flex;
    justify-content: center;
    gap: 16px;
  }

  .io-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
  }

  .io-label {
    font-weight: bold;
    color: #444;
  }

  .input-row {
    display: flex;
    gap: 6px;
    width: 100%;
  }

  .prefix-input, input[type=text] {
    border-radius: 6px;
    border: 1px solid #ccc;
    padding: 6px;
    font-size: 0.95rem;
    text-align: center;
  }

  .prefix-input {
    width: 90px;
  }

  input[type=text] {
    flex: 1;
  }

  .buttons {
    display: flex;
    justify-content: center;
  }

  button {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .flash-container {
    border-radius: 12px;
    padding: 12px;
    transition: background 0.3s;
  }

  #log {
    margin-top: 10px;
    text-align: left;
    font-size: 0.85rem;
    max-height: 200px;
    overflow-y: auto;
    border-top: 1px solid #ddd;
    padding-top: 10px;
  }
</style>
</head>
<body>

<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v2.0</header>

<div class="container">

  <div class="description">
    å½“å‰ä»…æ”¯æŒ ADM æ¨¡å¼ã€‚<br>
    åŠ å¯†ï¼šè¾“å…¥å·¦ 8 ä½æ•°å­—ï¼ˆå‰å››ä½å›ºå®š 7688ï¼‰ã€å³ 4 ä½æ•°å­— â†’ è¾“å‡º 6 ä½å­—ç¬¦ã€‚<br>
    è§£å¯†ï¼šè¾“å…¥ 6 ä½å­—ç¬¦ â†’ è¾“å‡ºå·¦ 7688+4 ä½ã€å³ 4 ä½æ•°å­—ã€‚<br>
    æ“ä½œç®€å•ï¼Œä¸¥æ ¼å¯é€†ã€‚
  </div>

  <h2>è¯·é€‰æ‹©æ¨¡å¼</h2>
  <div class="radio-group">
    <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
    <label style="color: gray;"><input type="radio" name="mode" value="å¾·ä¹‹é¦¨" disabled> å¾·ä¹‹é¦¨(å¼€å‘ä¸­)</label>
  </div>

  <h2>è¯·é€‰æ‹©æ“ä½œ</h2>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
    <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
  </div>

  <div class="flash-container" id="ioContainer">
    <div class="io-block">
      <span class="io-label">è¾“å…¥</span>
      <div class="input-row">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800">
        <input type="text" id="mainInput" maxlength="4" placeholder="4ä½æ•°å­—">
      </div>
    </div>

    <div class="buttons">
      <button id="computeBtn" onclick="compute()">ğŸ”’ è®¡ç®—</button>
    </div>

    <div class="io-block">
      <span class="io-label">è¾“å‡º</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
        <input type="text" id="output" readonly>
      </div>
    </div>
  </div>

  <div id="log"></div>
</div>

<script>
  // --- æ ¸å¿ƒç®—æ³• ---
  const key = "ht1416";
  const chars = 'ABCDEFGHJKLMNPRSTUVWXYZ23456789'; // é¿å… 0,O 1,I Q
  const charLen = chars.length;

  function seededRandom(seed) {
    let h = 0;
    for(let i=0;i<seed.length;i++) h=(h*31+seed.charCodeAt(i))>>>0;
    return function(){
      h ^= h<<13; h ^= h>>>17; h ^= h<<5;
      return (h>>>0)/0xFFFFFFFF;
    };
  }

  function generateMapping(seed) {
    const rng = seededRandom(seed);
    let arr = [];
    for(let i=0;i<10000;i++) arr.push(i.toString().padStart(4,'0'));
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(rng()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    const map=new Map(), rmap=new Map();
    arr.forEach((v,i)=>{
      map.set(i.toString().padStart(4,'0'),v);
      rmap.set(v,i.toString().padStart(4,'0'));
    });
    return {map,rmap};
  }

  const {map: encMap, rmap: decMap} = generateMapping(key);

  function encryptADM(left, right){
    const last4 = left.slice(-4);
    const combined = last4 + right;
    let num = parseInt(combined);
    let code='';
    for(let i=0;i<6;i++){
      code+=chars[num%charLen];
      num=Math.floor(num/charLen);
    }
    return code;
  }

  function decryptADM(code){
    let num=0;
    for(let i=code.length-1;i>=0;i--){
      num=num*charLen + chars.indexOf(code[i]);
    }
    const str=num.toString().padStart(8,'0');
    const left = '7688'+str.slice(0,4);
    const right = str.slice(4,8);
    return {left,right};
  }

  // --- UIé€»è¾‘ ---
  const modeRadios=document.querySelectorAll('input[name="operation"]');
  const prefixInput=document.getElementById('prefixInput');
  const mainInput=document.getElementById('mainInput');
  const prefixOutput=document.getElementById('prefixOutput');
  const output=document.getElementById('output');
  const ioContainer=document.getElementById('ioContainer');
  const computeBtn=document.getElementById('computeBtn');

  function updateUI(){
    const op=document.querySelector('input[name="operation"]:checked').value;
    if(op==='encrypt'){
      prefixInput.value='76880800';
      prefixInput.readOnly=false;
      mainInput.value='';
      mainInput.maxLength=4;
      mainInput.placeholder='4ä½æ•°å­—';
      prefixOutput.value='HT-';
      output.value='';
      computeBtn.innerText='ğŸ”’ è®¡ç®—';
      computeBtn.style.background='#4cafef';
    }else{
      prefixInput.value='HT-';
      prefixInput.readOnly=true;
      mainInput.value='';
      mainInput.maxLength=6;
      mainInput.placeholder='6ä½å­—ç¬¦';
      prefixOutput.value='';
      output.value='';
      computeBtn.innerText='ğŸ”“ è®¡ç®—';
      computeBtn.style.background='#ff7043';
    }
    ioContainer.style.background='transparent';
  }

  modeRadios.forEach(r=>{
    r.addEventListener('change',updateUI);
  });

  function compute(){
    const op=document.querySelector('input[name="operation"]:checked').value;
    let res='';
    try{
      if(op==='encrypt'){
        const left=prefixInput.value;
        const right=mainInput.value;
        if(!/^\d{4}$/.test(right)){
          alert('è¯·è¾“å…¥4ä½æ•°å­—');
          return;
        }
        res=encryptADM(left,right);
        prefixOutput.value='HT-';
        output.value=res;
        flash('#4cafef');
      }else{
        const code=mainInput.value;
        if(!/^[A-HJ-NP-Z2-9]{6}$/.test(code)){
          alert('è¯·è¾“å…¥6ä½å­—ç¬¦');
          return;
        }
        const {left,right}=decryptADM(code);
        prefixOutput.value=left;
        output.value=right;
        flash('#ff7043');
      }
      log(op, prefixInput.value, mainInput.value, prefixOutput.value, output.value);
    }catch(e){
      alert('æ“ä½œå¤±è´¥');
    }
  }

  function flash(color){
    ioContainer.style.background=color+'55';
    setTimeout(()=>{ioContainer.style.background=color+'33';},300);
    setTimeout(()=>{ioContainer.style.background='transparent';},1000);
  }

  const logEl=document.getElementById('log');
  function log(op,left,right,outLeft,outRight){
    const time=new Date().toLocaleTimeString();
    const msg=`[${time}] æ“ä½œ:${op} è¾“å…¥:${left}+${right} â†’ è¾“å‡º:${outLeft}+${outRight}`;
    logEl.innerHTML=`<div>${msg}</div>`+logEl.innerHTML;
  }

  // åˆå§‹åŒ–
  updateUI();
</script>
</body>
</html>
