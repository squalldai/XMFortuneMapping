<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数字加密解密工具</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #fdfbfb, #ebedee);
      color: #333;
      text-align: center;
    }
    header {
      width: 100%;
      height: 120px;
      background: linear-gradient(90deg, #ffb74d, #ff7043);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    header h1 {
      position: relative;
      color: white;
      font-size: 26px;
      letter-spacing: 2px;
      text-shadow: 0 2px 6px rgba(0,0,0,0.3);
      z-index: 1;
    }
    .container {
      margin: 20px auto;
      max-width: 420px;
      background: rgba(255,255,255,0.75);
      backdrop-filter: blur(12px);
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }
    .section {
      margin: 18px 0;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 8px;
      font-size: 15px;
      color: #444;
    }
    .input-row, .output-row {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 14px;
    }
    .prefix {
      font-size: 18px;
      font-weight: bold;
      margin-right: 8px;
      min-width: 75px;
      text-align: right;
      color: #ff7043;
    }
    input {
      width: 140px;
      padding: 10px;
      font-size: 16px;
      text-align: center;
      border: none;
      border-radius: 8px;
      outline: none;
      background: rgba(255,255,255,0.8);
      box-shadow: inset 2px 2px 6px rgba(0,0,0,0.1),
                  inset -2px -2px 6px rgba(255,255,255,0.8);
    }
    button {
      padding: 10px 18px;
      margin: 8px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    }
    button.encrypt {
      background: linear-gradient(145deg,#66bb6a,#43a047);
      color: white;
    }
    button.decrypt {
      background: linear-gradient(145deg,#42a5f5,#1e88e5);
      color: white;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(0,0,0,0.2);
    }
    .highlight {
      animation: flash 1s;
    }
    @keyframes flash {
      0% { background-color: rgba(255,255,0,0.3); }
      100% { background-color: transparent; }
    }
    .log {
      margin-top: 20px;
      text-align: left;
      font-size: 14px;
      background: linear-gradient(145deg,#fafafa,#f0f0f0);
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 12px;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: inset 2px 2px 6px rgba(0,0,0,0.05);
    }
    .mode-options {
      margin-bottom: 15px;
    }
    .mode-options label {
      margin-right: 12px;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <header>
    <h1>数字加密解密工具</h1>
  </header>

  <div class="container">
    <p>本工具用于对四位数字进行加密和解密，确保数据传输过程中的安全与可逆性。</p>

    <div class="mode-options">
      <label>选择模式</label>
      <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
      <label><input type="radio" name="mode" value="DZC" disabled> <span style="color:gray;">德之馨(开发中)</span></label>
    </div>

    <div class="section">
      <label>输入数字</label>
      <div class="input-row">
        <span class="prefix" id="inputPrefix"></span>
        <input type="text" id="inputText" maxlength="4" placeholder="输入4位数字">
      </div>
    </div>

    <div class="section">
      <button class="encrypt" onclick="handleEncrypt()">🔒 加密</button>
      <button class="decrypt" onclick="handleDecrypt()">🔓 解密</button>
    </div>

    <div class="section">
      <label>结果</label>
      <div class="output-row">
        <span class="prefix" id="outputPrefix"></span>
        <input type="text" id="outputText" readonly>
      </div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <script>
    // ===== 加密解密算法（密钥驱动洗牌双射） =====
    const key = "ht1416";

    function seededRandom(seed) {
      let x = 0;
      for (let i = 0; i < seed.length; i++) x += seed.charCodeAt(i);
      return function() {
        x ^= x << 13; x ^= x >> 17; x ^= x << 5;
        return (x >>> 0) / 4294967296;
      };
    }

    function generateMapping(seed) {
      const rng = seededRandom(seed);
      const nums = [];
      for (let i=0;i<10000;i++) nums.push(i);
      for (let i=nums.length-1;i>0;i--) {
        const j = Math.floor(rng()*(i+1));
        [nums[i],nums[j]]=[nums[j],nums[i]];
      }
      const encMap = new Map();
      const decMap = new Map();
      for (let i=0;i<10000;i++) {
        encMap.set(i, nums[i]);
        decMap.set(nums[i], i);
      }
      return {encMap, decMap};
    }

    const {encMap, decMap} = generateMapping(key);

    function encrypt(num) {
      const n = parseInt(num,10);
      if(isNaN(n)||n<0||n>9999) return null;
      return encMap.get(n).toString().padStart(4,"0");
    }
    function decrypt(num) {
      const n = parseInt(num,10);
      if(isNaN(n)||n<0||n>9999) return null;
      return decMap.get(n).toString().padStart(4,"0");
    }

    // ===== 按钮操作逻辑 =====
    function handleEncrypt(){
      const input=document.getElementById("inputText").value;
      const output=encrypt(input);
      if(output===null){alert("请输入4位数字");return;}
      document.getElementById("inputPrefix").textContent="800880";
      document.getElementById("outputPrefix").textContent="HT-";
      document.getElementById("outputText").value=output;
      logAction("加密",input,output);
    }
    function handleDecrypt(){
      const input=document.getElementById("inputText").value;
      const output=decrypt(input);
      if(output===null){alert("请输入4位数字");return;}
      document.getElementById("inputPrefix").textContent="HT-";
      document.getElementById("outputPrefix").textContent="800880";
      document.getElementById("outputText").value=output;
      logAction("解密",input,output);
    }

    function logAction(type,input,output){
      const log=document.getElementById("log");
      const time=new Date().toLocaleTimeString();
      log.innerHTML=`<div>[${time}] ${type}: ${input} → ${output}</div>`+log.innerHTML;
    }
  </script>
</body>
</html>
