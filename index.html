<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>华添香精编号加密解密工具 v1.8.8</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fb;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: linear-gradient(135deg, #ffecd2, #fcb69f);
      height: 15vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: bold;
      color: #333;
    }

    .container {
      max-width: 480px;
      margin: 20px auto;
      padding: 20px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    h2 {
      margin-bottom: 12px;
      font-size: 1.2rem;
      color: #444;
    }

    .radio-group {
      margin: 12px 0;
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    label {
      font-size: 0.95rem;
    }

    .io-block {
      margin: 20px 0;
      text-align: left;
    }

    .io-label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.9rem;
      font-weight: bold;
      color: #555;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .prefix-input {
      width: 90px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 0.9rem;
    }

    input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      text-align: center;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 20px 0;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    button.encrypt {
      background: #4cafef;
      color: white;
    }

    button.decrypt {
      background: #ff7043;
      color: white;
    }

    button:hover {
      transform: scale(1.05);
      opacity: 0.9;
    }

    #log {
      margin-top: 20px;
      text-align: left;
      font-size: 0.85rem;
      max-height: 200px;
      overflow-y: auto;
      border-top: 1px solid #ddd;
      padding-top: 10px;
    }
  </style>
</head>
<body>
  <header>华添香精编号加密解密工具 v1.8.8</header>
  <div class="container">
    <h2>说明</h2>
    <p style="font-size:0.85rem;color:#555;font-style:italic;">
      当前仅支持ADM模式。加密时，左侧输入前4位固定7688，后4位可编辑。右侧输入4位数字。加密输出为6位字符+右侧4位数字。解密时，输入左固定HT-，右侧6位字符，输出左侧8位数字，右侧4位数字。严格可逆。
    </p>

    <h2>请选择模式</h2>
    <div class="radio-group">
      <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
      <label style="color: gray;"><input type="radio" name="mode" value="德之馨" disabled> 德之馨(开发中)</label>
    </div>

    <h2>请选择操作</h2>
    <div class="radio-group">
      <label><input type="radio" name="operation" value="encrypt" checked> 加密</label>
      <label><input type="radio" name="operation" value="decrypt"> 解密</label>
    </div>

    <div class="io-block">
      <span class="io-label">输入数字</span>
      <div class="input-row">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800">
        <input type="text" id="mainInput" maxlength="6" placeholder="输入数字">
      </div>
    </div>

    <div class="buttons">
      <button id="calcBtn" onclick="process()" class="encrypt">🔒 计算</button>
    </div>

    <div class="io-block">
      <span class="io-label">结果</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-">
        <input type="text" id="output" readonly>
      </div>
    </div>

    <div id="log"></div>
  </div>

  <script>
    // --- 固定密钥 ---
    const key = "ht1416";

    // --- 可逆字符表（去掉易混淆字符） ---
    const chars = "23456789ABCDEFGHJKLMNPRSTUVWXYZ";

    function seededRandom(seed) {
      let h = 0;
      for (let i = 0; i < seed.length; i++) {
        h = (h * 31 + seed.charCodeAt(i)) >>> 0;
      }
      return function() {
        h ^= h << 13;
        h ^= h >>> 17;
        h ^= h << 5;
        return (h >>> 0) / 0xFFFFFFFF;
      };
    }

    function encryptADM(left4, right4) {
      const inputNum = left4 + right4; // 8位数字
      const rng = seededRandom(key + inputNum);
      let output = "";
      for (let i = 0; i < 6; i++) {
        output += chars[Math.floor(rng() * chars.length)];
      }
      return output;
    }

    function decryptADM(sixChar, right4) {
      // 可逆方案：直接通过伪随机函数验证所有可能的左4+right4组合
      // 这里因为输入空间小，8位数字的后4位可枚举0-9999
      const rightStr = right4.padStart(4, "0");
      for(let i=0;i<10000;i++){
        const left4 = i.toString().padStart(4,'0');
        const candidate = encryptADM(left4,rightStr);
        if(candidate === sixChar) return left4;
      }
      return null;
    }

    function process() {
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const operation = document.querySelector('input[name="operation"]:checked').value;

      let prefix = document.getElementById("prefixInput").value.trim();
      let main = document.getElementById("mainInput").value.trim();
      let prefixOut = document.getElementById("prefixOutput");
      let output = document.getElementById("output");
      const btn = document.getElementById("calcBtn");

      // UI刷新
      if(operation === "decrypt"){
        document.getElementById("prefixInput").value = "HT-";
        document.getElementById("mainInput").value = "";
        prefix = "HT-";
      } else {
        document.getElementById("prefixInput").value = "7688" + prefix.slice(4);
      }
      output.value = "";
      prefixOut.value = "HT-";

      // 校验
      if(operation === "encrypt"){
        if(!/^\d{4}$/.test(main)){
          alert("右侧输入必须为4位数字！");
          return;
        }
        const left4 = prefix.slice(4,8);
        const cipher = encryptADM(left4, main);
        output.value = cipher + main;
        btn.innerHTML = "🔒 计算";
        btn.className = "encrypt";
      } else {
        if(!/^[23456789ABCDEFGHJKLMNPRSTUVWXYZ]{6}$/.test(main)){
          alert("右侧输入必须为6位字符！");
          return;
        }
        const right4 = prompt("请输入原右侧4位数字，用于解密：","0000");
        const left4 = decryptADM(main,right4);
        if(left4===null){
          alert("解密失败！");
          return;
        }
        output.value = "7688" + left4 + right4;
        btn.innerHTML = "🔓 计算";
        btn.className = "decrypt";
      }

      // log
      const logEl = document.getElementById("log");
      const time = new Date().toLocaleTimeString();
      logEl.innerHTML = `<div>[${time}] 模式:${mode} 操作:${operation} 输入:${prefix}+${main} → 输出:${output.value}</div>` + logEl.innerHTML;
    }
  </script>
</body>
</html>
