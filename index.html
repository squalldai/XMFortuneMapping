<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åŠ å¯†è§£å¯†å·¥å…· v1.6.4</title>
<style>
body { font-family: Arial, sans-serif; background: #f8f9fb; margin:0; padding:0; text-align:center; }
header { background: linear-gradient(135deg,#ffecd2,#fcb69f); height:15vh; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:#333; }
.container { max-width:480px; margin:20px auto; padding:20px; background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition: background 0.5s; }
h2 { margin-bottom:12px; font-size:1.2rem; color:#444; }
.radio-group { margin:12px 0; display:flex; justify-content:center; gap:16px; }
label { font-size:0.95rem; }
.io-block { margin:20px 0; text-align:left; transition: background 0.5s; }
.io-label { display:block; margin-bottom:6px; font-size:0.9rem; font-weight:bold; color:#555; }
.input-row { display:flex; align-items:center; gap:6px; }
.prefix-input { width:90px; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:0.9rem; }
input[type="text"] { flex:1; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:1rem; text-align:center; transition: background 0.5s; }
.button-calc { width:200px; padding:12px 0; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer; margin:20px 0; transition:all 0.2s, background 0.5s; color:white; }
#log { margin-top:20px; text-align:left; font-size:0.85rem; max-height:200px; overflow-y:auto; border-top:1px solid #ddd; padding-top:10px; }

/* é—ªçƒæ ·å¼ */
.flash-encrypt { background-color: rgba(76,175,239,0.3); }
.flash-decrypt { background-color: rgba(255,112,67,0.3); }
</style>
</head>
<body>
<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v1.6.4</header>
<div class="container" id="module">
<h2>è¯·é€‰æ‹©æ¨¡å¼</h2>
<div class="radio-group">
  <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
  <label style="color: gray;"><input type="radio" name="mode" value="å¾·ä¹‹é¦¨" disabled> å¾·ä¹‹é¦¨(å¼€å‘ä¸­)</label>
</div>

<h2>è¯·é€‰æ‹©æ“ä½œ</h2>
<div class="radio-group">
  <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
  <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
</div>

<div class="io-block" id="inputBlock">
<span class="io-label">è¾“å…¥</span>
<div class="input-row">
  <input type="text" id="prefixInput" class="prefix-input" value="76880800">
  <input type="text" id="mainInput" maxlength="4" placeholder="è¾“å…¥4ä½æ•°å­—">
</div>
</div>

<button class="button-calc" id="calcBtn" onclick="calculate()">ğŸ”’ è®¡ç®—</button>

<div class="io-block" id="outputBlock">
<span class="io-label">ç»“æœ</span>
<div class="input-row">
  <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
  <input type="text" id="output" readonly>
</div>
</div>

<div id="log"></div>
</div>

<script>
// å®‰å…¨å­—ç¬¦é›†ï¼ˆè½¦ç‰Œé˜²å‘†è®¾è®¡ï¼‰
const chars = '23456789ABCDEFGHJKLMNPRSTUVWXYZ';

// ç§å­ä¼ªéšæœº
function seededRandom(seed){
  let h=0;
  for(let i=0;i<seed.length;i++) h=(h*31+seed.charCodeAt(i))>>>0;
  return function(){h^=h<<13; h^=h>>>17; h^=h<<5; return (h>>>0)/0xFFFFFFFF;};
}

// å¯é€†ç½®æ¢å‡½æ•°
function fpeEncrypt(index,key){
  let rng=seededRandom(key+index);
  return (index*1103515245+Math.floor(rng()*1000000))%1000000000000;
}
function fpeDecrypt(index,key){
  let inv=178956971;
  return (index*inv)%1000000000000;
}

// 12ä½æ•°å­— -> 6ä½å®‰å…¨å­—ç¬¦
function encode(input12,key){
  const idx=parseInt(input12,10);
  const perm=fpeEncrypt(idx,key);
  let out='',n=perm;
  for(let i=0;i<6;i++){ out=chars[n%chars.length]+out; n=Math.floor(n/chars.length);}
  return out;
}

// 6ä½å®‰å…¨å­—ç¬¦ -> 12ä½æ•°å­—
function decode(output6,key){
  let n=0;
  for(let i=0;i<6;i++) n=n*chars.length+chars.indexOf(output6[i]);
  const orig=fpeDecrypt(n,key);
  return orig.toString().padStart(12,'0');
}

// æ›´æ–°æŒ‰é’®å›¾æ ‡å’Œé¢œè‰²
function updateButtonStyle() {
  const op = document.querySelector('input[name="operation"]:checked').value;
  const btn = document.getElementById('calcBtn');
  if(op==='encrypt'){
    btn.textContent='ğŸ”’ è®¡ç®—';
    btn.style.background='#4cafef';
  } else {
    btn.textContent='ğŸ”“ è®¡ç®—';
    btn.style.background='#ff7043';
  }
}

// ç‚¹å‡»è®¡ç®—æŒ‰é’®æ—¶é—ªçƒæ¨¡å—
function flashModule() {
  const module = document.getElementById('module');
  const op = document.querySelector('input[name="operation"]:checked').value;
  const cls = op==='encrypt'?'flash-encrypt':'flash-decrypt';
  module.classList.add(cls);
  setTimeout(()=>{ module.classList.remove(cls); module.style.background='#fff'; },500);
}

// è®¡ç®—æŒ‰é’®
function calculate(){
  flashModule();
  updateButtonStyle();
  
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const operation=document.querySelector('input[name="operation"]:checked').value;

  let left=document.getElementById("prefixInput").value.trim();
  let right=document.getElementById("mainInput").value.trim();
  let outLeft=document.getElementById("prefixOutput");
  let outRight=document.getElementById("output");

  if(operation==='encrypt'){
    if(!/^\d{8}$/.test(left)||!left.startsWith('7688')){ alert('å·¦è¾“å…¥å¿…é¡»8ä½æ•°å­—ä¸”ä»¥7688å¼€å¤´'); return;}
    if(!/^\d{4}$/.test(right)){ alert('å³è¾“å…¥å¿…é¡»4ä½æ•°å­—'); return;}
    const input12=left+right;
    const result=encode(input12,'ht1416');
    outLeft.value='HT-';
    outRight.value=result;
    logOperation(mode,operation,input12,'HT-'+result);
  } else {
    if(left!=='HT-'){ alert('å·¦è¾“å…¥å¿…é¡»ä¸ºHT-'); return;}
    if(!/^[0-9A-Z]{6}$/.test(right)){ alert('å³è¾“å…¥å¿…é¡»6ä½æ•°å­—+å¤§å†™å­—æ¯'); return;}
    const original=decode(right,'ht1416');
    outLeft.value=original.slice(0,8);
    outRight.value=original.slice(8);
    logOperation(mode,operation,left+right,original);
  }
}

// æ—¥å¿—è®°å½•
function logOperation(mode,op,input,output){
  const log=document.getElementById("log");
  const time=new Date().toLocaleTimeString();
  log.innerHTML=`<div>[${time}] æ¨¡å¼:${mode} æ“ä½œ:${op} è¾“å…¥:${input} â†’ è¾“å‡º:${output}</div>`+log.innerHTML;
}

// è‡ªåŠ¨æ›´æ–°è¾“å…¥è¾“å‡ºæ¡†
const operationRadios=document.querySelectorAll('input[name="operation"]');
operationRadios.forEach(radio=>{ radio.addEventListener('change',()=>{ updateIOFields(); updateButtonStyle(); }); });

function updateIOFields(){
  const op=document.querySelector('input[name="operation"]:checked').value;
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const prefixInput=document.getElementById('prefixInput');
  const mainInput=document.getElementById('mainInput');
  const prefixOutput=document.getElementById('prefixOutput');
  const output=document.getElementById('output');

  if(mode==='ADM'){
    if(op==='decrypt'){
      prefixInput.value='HT-';
      mainInput.value='';
      mainInput.placeholder='è¾“å…¥6ä½æ•°å­—æˆ–å¤§å†™å­—æ¯';
      prefixOutput.value='';
      output.value='';
    } else {
      prefixInput.value='76880800';
      mainInput.value='';
      mainInput.placeholder='è¾“å…¥4ä½æ•°å­—';
      prefixOutput.value='HT-';
      output.value='';
    }
  }
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
updateIOFields();
updateButtonStyle();
</script>
</body>
</html>
