<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v3.0ï¼ˆé‡Œç¨‹ç¢‘1UIï¼‰</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; text-align:center; }
header { background: linear-gradient(135deg,#ffecd2,#fcb69f); height:10vh; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold; color:#333; }
.container { max-width:500px; margin:10px auto; padding:16px; background:#fff; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:14px; }
.description { font-size:0.8rem; color:#555; font-style:italic; background:#fafafa; padding:6px; border-radius:6px; text-align:left; }
.section-title { font-size:0.95rem; font-weight:bold; margin:6px 0 4px 0; color:#333; text-align:left; }
.radio-group { display:flex; justify-content:flex-start; gap:12px; margin-bottom:6px; }
.io-block { display:flex; flex-direction:column; align-items:flex-start; gap:6px; width:100%; }
.io-label { font-weight:bold; color:#444; }
.input-row { display:flex; gap:6px; width:100%; }
.prefix-input, input[type=text] { border-radius:6px; border:1px solid #ccc; padding:8px; font-size:1rem; text-align:center; }
.prefix-input { width:110px; }
input[type=text] { flex:1; }
.buttons { display:flex; justify-content:center; margin:8px 0; }
button { padding:8px 16px; border:none; border-radius:8px; font-size:0.95rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:6px; }
button:disabled { opacity:0.5; cursor:not-allowed; }
.flash-container { border-radius:12px; padding:12px; transition: background 0.3s; background:#fdfdfd; }
#log { margin-top:8px; text-align:left; font-size:0.8rem; max-height:200px; overflow-y:auto; border-top:1px solid #eee; padding-top:6px; color:#333; }
.small-note { font-size:0.75rem; color:#666; text-align:left; }
</style>
</head>
<body>

<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v3.0ï¼ˆé‡Œç¨‹ç¢‘1UIï¼‰</header>

<div class="container">
  <div class="description">
    <div><strong>è¯´æ˜ï¼š</strong> ä½¿ç”¨é‡Œç¨‹ç¢‘1ç®—æ³•ï¼ˆFeistel + åŠ æ³•æ¨¡ï¼Œç§å­å›ºå®šï¼šht1416ï¼‰ã€‚</div>
    <div class="small-note">åŠ å¯†ï¼šè¾“å…¥å·¦ 8 ä½æ•°å­—ï¼ˆå‰å››ä½å›ºå®š <code>7688</code>ï¼‰ã€å³ 4 ä½æ•°å­— â†’ è¾“å‡º 6 ä½å­—ç¬¦ï¼ˆå‰ç¼€æ˜¾ç¤º <code>HT-</code>ï¼‰ã€‚</div>
    <div class="small-note">è§£å¯†ï¼šè¾“å…¥ 6 ä½å­—ç¬¦ â†’ è¾“å‡ºå·¦ä¾§ <code>7688+4ä½</code> ä¸å³ä¾§ 4 ä½æ•°å­—ã€‚</div>
  </div>

  <div class="section-title">ç®—æ³•æ¥æºï¼ˆé€‰æ‹©ï¼‰</div>
  <div class="radio-group">
    <label><input type="radio" name="algoSource" value="ADM" checked> ADM</label>
    <label><input type="radio" name="algoSource" value="SENSIENT"> æ£®é‘«ï¼ˆå¼€å‘ä¸­ï¼‰</label>
  </div>

  <div class="section-title">æ“ä½œï¼ˆåŠ å¯† / è§£å¯†ï¼‰</div>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
    <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
  </div>

  <div class="flash-container" id="ioContainer">
    <div class="io-block">
      <span class="io-label">è¾“å…¥</span>
      <div class="input-row">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800" />
        <input type="text" id="mainInput" maxlength="4" placeholder="4ä½æ•°å­—ï¼ˆåŠ å¯†ï¼‰/ 6ä½å­—ç¬¦ï¼ˆè§£å¯†ï¼‰" />
      </div>
    </div>

    <div class="buttons">
      <button id="computeBtn" onclick="compute()">ğŸ”’ è®¡ç®—</button>
    </div>

    <div class="io-block">
      <span class="io-label">è¾“å‡º</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly />
        <input type="text" id="output" readonly placeholder="6ä½å­—ç¬¦ / è§£å¯†å³ä¾§4ä½" />
      </div>
    </div>
  </div>

  <div id="log"></div>
</div>

<!-- ç®—æ³•æ–‡ä»¶ï¼šADMALGORITHEM.js ä¸ sensient.js -->
<script src="ADMALGORITHEM.js"></script>
<script src="sensient.js"></script>

<script>
/*
 UI æ§åˆ¶é€»è¾‘ï¼ˆä¸¥æ ¼æŒ‰é‡Œç¨‹ç¢‘1UIï¼‰
 - é»˜è®¤ç®—æ³• ADMï¼›å¦‚æœé€‰æ‹©æ£®é‘«ï¼Œä¼šè°ƒç”¨ SensientAlgorithmï¼ˆå½“å‰ä¸ºå ä½ï¼‰
 - åŠ å¯†æ¨¡å¼ï¼šprefixInput å¯ç¼–è¾‘ï¼ŒmainInput é™ 4 ä½æ•°å­—ï¼›è¾“å‡º HT- + 6ä½
 - è§£å¯†æ¨¡å¼ï¼šprefixInput å›ºå®š HT-ï¼ˆæ˜¾ç¤ºï¼‰ï¼ŒmainInput 6ä½å­—ç¬¦ï¼›è¾“å‡ºå·¦ä¾§ 8ä½æ•°å­—ï¼ˆ7688+ï¼‰å’Œå³ä¾§4ä½
*/

const ioContainer = document.getElementById('ioContainer');
const prefixInput = document.getElementById('prefixInput');
const mainInput = document.getElementById('mainInput');
const prefixOutput = document.getElementById('prefixOutput');
const output = document.getElementById('output');
const computeBtn = document.getElementById('computeBtn');
const logEl = document.getElementById('log');

function updateUIForMode(){
  const op = document.querySelector('input[name="operation"]:checked').value;
  if(op === 'encrypt'){
    prefixInput.value = '76880800';
    prefixInput.readOnly = false;
    mainInput.value = '';
    mainInput.maxLength = 4;
    mainInput.placeholder = '4ä½æ•°å­—';
    prefixOutput.value = 'HT-';
    output.value = '';
    computeBtn.innerText = 'ğŸ”’ è®¡ç®—';
    computeBtn.style.background = '#4cafef';
  } else {
    prefixInput.value = 'HT-';
    prefixInput.readOnly = true;
    mainInput.value = '';
    mainInput.maxLength = 6;
    mainInput.placeholder = '6ä½å­—ç¬¦';
    prefixOutput.value = '';
    output.value = '';
    computeBtn.innerText = 'ğŸ”“ è®¡ç®—';
    computeBtn.style.background = '#ff7043';
  }
  ioContainer.style.background = '#fdfdfd';
}

document.querySelectorAll('input[name="operation"]').forEach(r=> r.addEventListener('change', updateUIForMode));
updateUIForMode();

function flash(color){
  ioContainer.style.background = color + '33';
  setTimeout(()=> ioContainer.style.background = color + '22', 300);
  setTimeout(()=> ioContainer.style.background = '#fdfdfd', 1000);
}

function log(op,left,right,outLeft,outRight){
  const time = new Date().toLocaleTimeString();
  const msg = `[${time}] æ“ä½œ:${op} è¾“å…¥:${left}+${right} â†’ è¾“å‡º:${outLeft}+${outRight}`;
  logEl.innerHTML = `<div>${msg}</div>` + logEl.innerHTML;
}

function compute(){
  const algoSource = document.querySelector('input[name="algoSource"]:checked').value;
  const op = document.querySelector('input[name="operation"]:checked').value;

  try{
    if(op === 'encrypt'){
      const left = prefixInput.value.trim();
      const right = mainInput.value.trim();
      if(!/^\d{4}$/.test(right)){ alert('è¯·è¾“å…¥4ä½æ•°å­—ï¼ˆå³ä¾§ï¼‰'); return; }

      if(algoSource === 'ADM'){
        // ADMAlgorithm.encrypt(leftFull, right4) -> returns 6-char code (no "HT-")
        const code = ADMAlgorithm.encrypt(left, right);
        prefixOutput.value = 'HT-';
        output.value = code;
        flash('#4cafef');
        log('encrypt', left, right, 'HT-', code);
      } else {
        // æ£®é‘«å ä½
        const code = SensientAlgorithm.encrypt(left, right);
        prefixOutput.value = 'HT-';
        output.value = code;
        flash('#4cafef');
        log('encrypt', left, right, 'HT-', code);
      }

    } else { // decrypt
      const code = mainInput.value.trim();
      if(!/^[A-HJ-NP-Z2-9]{6}$/.test(code)){ alert('è¯·è¾“å…¥6ä½åˆæ³•ç¼–ç ï¼ˆå¤§å†™å­—æ¯/æ•°å­—ï¼‰'); return; }

      if(algoSource === 'ADM'){
        // ADMAlgorithm.decrypt(code) -> returns {left: '7688xxxx', right: 'yyyy'}
        const res = ADMAlgorithm.decrypt(code);
        prefixOutput.value = res.left; // 8ä½æ•°å­—ï¼ˆ7688+ï¼‰
        output.value = res.right;
        flash('#ff7043');
        log('decrypt', 'HT-', code, res.left, res.right);
      } else {
        const res = SensientAlgorithm.decrypt(code);
        // SensientAlgorithm currently returns object or string; keep consistent with placeholder
        if(typeof res === 'string'){
          prefixOutput.value = '';
          output.value = res;
          log('decrypt', 'HT-', code, '', res);
        } else {
          prefixOutput.value = res.left || '';
          output.value = res.right || '';
          log('decrypt', 'HT-', code, res.left, res.right);
        }
        flash('#ff7043');
      }
    }
  }catch(e){
    console.error(e);
    alert('æ“ä½œå¤±è´¥ï¼š' + (e && e.message ? e.message : 'æœªçŸ¥é”™è¯¯'));
  }
}
</script>
</body>
</html>
