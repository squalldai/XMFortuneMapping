<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>数字加密解密工具</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      color: #333;
      text-align: center;
    }
    header {
      width: 100%;
      height: 120px;
      background: #222;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    header h1 {
      position: relative;
      color: white;
      font-size: 22px;
      z-index: 1;
    }
    .container {
      margin: 20px auto;
      max-width: 400px;
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .section {
      margin: 15px 0;
    }
    label {
      font-weight: bold;
      display: block;
      margin-bottom: 6px;
    }
    .input-row, .output-row {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 12px;
    }
    .prefix {
      font-size: 18px;
      font-weight: bold;
      margin-right: 6px;
      min-width: 70px;
      text-align: right;
    }
    input {
      width: 130px;
      padding: 8px;
      font-size: 16px;
      text-align: center;
    }
    button {
      padding: 8px 14px;
      margin: 6px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      transition: background 0.3s;
    }
    button.encrypt { background: #4CAF50; color: white; }
    button.decrypt { background: #2196F3; color: white; }
    button.encrypt:hover { background: #45a049; }
    button.decrypt:hover { background: #1976d2; }
    .highlight {
      animation: flash 1s;
    }
    @keyframes flash {
      0% { background-color: rgba(255,255,0,0.3); }
      100% { background-color: transparent; }
    }
    .log {
      margin-top: 20px;
      text-align: left;
      font-size: 14px;
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      max-height: 180px;
      overflow-y: auto;
    }
    .mode-options {
      margin-bottom: 15px;
    }
    .mode-options label {
      margin-right: 12px;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <header>
    <canvas id="pixelHeader"></canvas>
    <h1>数字加密解密工具</h1>
  </header>

  <div class="container">
    <p>本工具用于对四位数字进行加密和解密，确保数据传输过程中的安全与可逆性。</p>

    <div class="mode-options">
      <label>选择模式</label>
      <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
      <label><input type="radio" name="mode" value="DZC" disabled> <span style="color:gray;">德之馨(开发中)</span></label>
    </div>

    <div class="section">
      <label>输入数字</label>
      <div class="input-row">
        <span class="prefix" id="inputPrefix"></span>
        <input type="text" id="inputText" maxlength="4" placeholder="输入4位数字">
      </div>
    </div>

    <div class="section">
      <button class="encrypt" onclick="handleEncrypt()">
        🔒 加密
      </button>
      <button class="decrypt" onclick="handleDecrypt()">
        🔓 解密
      </button>
    </div>

    <div class="section">
      <label>结果</label>
      <div class="output-row">
        <span class="prefix" id="outputPrefix"></span>
        <input type="text" id="outputText" readonly>
      </div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <script>
    // ===== 生成像素画横幅 =====
    const canvas = document.getElementById("pixelHeader");
    const ctx = canvas.getContext("2d");

    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
      drawPixelArt();
    }

    function drawPixelArt() {
      const w = canvas.width;
      const h = canvas.height;
      const pixel = 2; // 像素点大小
      ctx.clearRect(0,0,w,h);

      // 背景
      ctx.fillStyle = "#ffe0b2";
      ctx.fillRect(0,0,w,h);

      // 随机糖果点缀
      for (let i=0;i<120;i++) {
        const x = Math.random()*w;
        const y = Math.random()*h;
        ctx.fillStyle = ["#f48fb1","#ce93d8","#81d4fa","#aed581"][Math.floor(Math.random()*4)];
        ctx.fillRect(x, y, pixel, pixel);
      }

      // 饮料杯
      ctx.fillStyle="#42a5f5";
      ctx.fillRect(40, h-50, 20, 40);
      ctx.fillStyle="#1976d2";
      ctx.fillRect(45, h-45, 10, 30);
      ctx.fillStyle="#fff";
      ctx.fillRect(48,h-60,4,10);

      // 蛋糕
      ctx.fillStyle="#ffcc80";
      ctx.fillRect(100,h-40,50,20);
      ctx.fillStyle="#ffb74d";
      ctx.fillRect(100,h-60,50,20);
      ctx.fillStyle="#d32f2f";
      ctx.fillRect(100,h-60,50,5);

      // 面包
      ctx.fillStyle="#8d6e63";
      ctx.fillRect(180,h-30,60,15);
      ctx.fillStyle="#a1887f";
      ctx.fillRect(180,h-45,60,15);

      // 饼干
      ctx.fillStyle="#fbc02d";
      ctx.fillRect(270,h-30,20,20);
      ctx.fillStyle="#6d4c41";
      for(let i=0;i<5;i++){
        ctx.fillRect(272+Math.random()*12, h-28+Math.random()*12, 2,2);
      }
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // ===== 加密解密算法（密钥驱动洗牌双射） =====
    const key = "ht1416";

    function seededRandom(seed) {
      let x = 0;
      for (let i = 0; i < seed.length; i++) x += seed.charCodeAt(i);
      return function() {
        x ^= x << 13; x ^= x >> 17; x ^= x << 5;
        return (x >>> 0) / 4294967296;
      };
    }

    function generateMapping(seed) {
      const rng = seededRandom(seed);
      const nums = [];
      for (let i=0;i<10000;i++) nums.push(i);
      for (let i=nums.length-1;i>0;i--) {
        const j = Math.floor(rng()*(i+1));
        [nums[i],nums[j]]=[nums[j],nums[i]];
      }
      const encMap = new Map();
      const decMap = new Map();
      for (let i=0;i<10000;i++) {
        encMap.set(i, nums[i]);
        decMap.set(nums[i], i);
      }
      return {encMap, decMap};
    }

    const {encMap, decMap} = generateMapping(key);

    function encrypt(num) {
      const n = parseInt(num,10);
      if(isNaN(n)||n<0||n>9999) return null;
      return encMap.get(n).toString().padStart(4,"0");
    }
    function decrypt(num) {
      const n = parseInt(num,10);
      if(isNaN(n)||n<0||n>9999) return null;
      return decMap.get(n).toString().padStart(4,"0");
    }

    // ===== 按钮操作逻辑 =====
    function handleEncrypt(){
      const input=document.getElementById("inputText").value;
      const output=encrypt(input);
      if(output===null){alert("请输入4位数字");return;}
      document.getElementById("inputPrefix").textContent="800880";
      document.getElementById("outputPrefix").textContent="HT-";
      document.getElementById("outputText").value=output;
      logAction("加密",input,output);
    }
    function handleDecrypt(){
      const input=document.getElementById("inputText").value;
      const output=decrypt(input);
      if(output===null){alert("请输入4位数字");return;}
      document.getElementById("inputPrefix").textContent="HT-";
      document.getElementById("outputPrefix").textContent="800880";
      document.getElementById("outputText").value=output;
      logAction("解密",input,output);
    }

    function logAction(type,input,output){
      const log=document.getElementById("log");
      const time=new Date().toLocaleTimeString();
      log.innerHTML=`<div>[${time}] ${type}: ${input} → ${output}</div>`+log.innerHTML;
    }
  </script>
</body>
</html>
