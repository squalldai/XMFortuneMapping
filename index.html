<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v3.1</title>
<style>
body {font-family: Arial, sans-serif;background: #f0f2f5;margin: 0;padding: 0;text-align: center;}
header {background: linear-gradient(135deg,#ffecd2,#fcb69f);height: 10vh;display: flex;align-items: center;justify-content: center;font-size: 1.5rem;font-weight: bold;color: #333;}
.container {max-width: 500px;margin: 10px auto;padding: 16px;background: #fff;border-radius: 12px;box-shadow: 0 3px 10px rgba(0,0,0,0.08);display: flex;flex-direction: column;gap: 14px;}
.description {font-size: 0.8rem;color: #555;font-style: italic;background: #fafafa;padding: 6px;border-radius: 6px;}
.section-title {font-size: 0.95rem;font-weight: bold;margin: 6px 0 4px 0;color: #333;}
.radio-group {display: flex;justify-content: center;gap: 12px;margin-bottom: 6px;}
.io-block {display: flex;flex-direction: column;align-items: flex-start;gap: 6px;width: 100%;}
.io-label {font-weight: bold;color: #444;}
.input-row {display: flex;gap: 6px;width: 100%;}
.prefix-input, input[type=text] {border-radius: 6px;border: 1px solid #ccc;padding: 8px;font-size: 1rem;text-align: center;}
.prefix-input {width: 90px;}
input[type=text] {flex: 1;}
.buttons {display: flex;justify-content: center;margin: 8px 0;}
button {padding: 8px 16px;border: none;border-radius: 8px;font-size: 0.95rem;cursor: pointer;transition: all 0.2s;display: flex;align-items: center;gap: 6px;}
button:disabled {opacity: 0.5;cursor: not-allowed;}
.flash-container {border-radius: 12px;padding: 12px;transition: background 0.3s;background: #fdfdfd;}
#log {margin-top: 8px;text-align: left;font-size: 0.8rem;max-height: 160px;overflow-y: auto;border-top: 1px solid #eee;padding-top: 6px;color: #333;}
</style>
</head>
<body>

<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v3.1</header>

<div class="container">
  <div class="description">
    åŠ å¯†æ¨¡å¼ï¼šè¾“å…¥ ADM æˆ– æ£®é‘« ç®—æ³•å¯¹åº”æ ¼å¼ â†’ è¾“å‡ºåŠ å¯†ã€‚<br>
    è§£å¯†æ¨¡å¼ï¼šè¾“å…¥åŠ å¯†å­—ç¬¦ â†’ è¾“å‡ºåŸå§‹æ•°æ®ã€‚
  </div>

  <div class="section-title">æ¨¡å¼</div>
  <div class="radio-group">
    <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
    <label><input type="radio" name="mode" value="æ£®é‘«"> æ£®é‘«</label>
  </div>

  <div class="section-title">æ“ä½œ</div>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
    <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
  </div>

  <div class="flash-container" id="ioContainer">
    <div class="io-block">
      <span class="io-label">è¾“å…¥</span>
      <div class="input-row" id="inputRow">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800">
        <input type="text" id="mainInput" maxlength="4" placeholder="4ä½æ•°å­—">
      </div>
    </div>

    <div class="buttons">
      <button id="computeBtn" onclick="compute()">ğŸ”’ è®¡ç®—</button>
    </div>

    <div class="io-block">
      <span class="io-label">è¾“å‡º</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
        <input type="text" id="output" readonly>
      </div>
    </div>
  </div>

  <div id="log"></div>
</div>

<script src="ADM.js"></script>
<script src="SENSIENT.js"></script>

<script>
const modeRadios = document.querySelectorAll('input[name="operation"]');
const algoRadios = document.querySelectorAll('input[name="mode"]');
const prefixInput = document.getElementById('prefixInput');
const mainInput = document.getElementById('mainInput');
const inputRow = document.getElementById('inputRow');
const prefixOutput = document.getElementById('prefixOutput');
const output = document.getElementById('output');
const ioContainer = document.getElementById('ioContainer');
const computeBtn = document.getElementById('computeBtn');

function updateUI(){
  const algo = document.querySelector('input[name="mode"]:checked').value;
  const op = document.querySelector('input[name="operation"]:checked').value;

  if(algo==='ADM'){
    prefixOutput.style.display='inline-block';
    if(op==='encrypt'){
      prefixInput.value='76880800'; prefixInput.readOnly=false;
      mainInput.value=''; mainInput.maxLength=4; mainInput.placeholder='4ä½æ•°å­—';
      prefixOutput.value='HT-'; output.value=''; computeBtn.innerText='ğŸ”’ è®¡ç®—'; computeBtn.style.background='#4cafef';
    } else {
      prefixInput.value='HT-'; prefixInput.readOnly=true;
      mainInput.value=''; mainInput.maxLength=6; mainInput.placeholder='6ä½å­—ç¬¦';
      prefixOutput.value=''; output.value=''; computeBtn.innerText='ğŸ”“ è®¡ç®—'; computeBtn.style.background='#ff7043';
    }
  } else if(algo==='æ£®é‘«'){
    // æ£®é‘« UI
    prefixOutput.style.display='none'; // è¾“å‡ºæ¡†å·¦ä¾§éšè—
    prefixInput.style.display='none'; // è¾“å…¥å·¦ä¾§éšè—
    mainInput.maxLength=(op==='encrypt')?8:6;
    mainInput.placeholder=(op==='encrypt')?'2æ•°å­—+2å­—æ¯+4æ•°å­—':'6ä½å­—ç¬¦';
    mainInput.value=''; output.value='';
    computeBtn.innerText=(op==='encrypt')?'ğŸ”’ è®¡ç®—':'ğŸ”“ è®¡ç®—';
    computeBtn.style.background=(op==='encrypt')?'#4cafef':'#ff7043';
  }
  ioContainer.style.background='#fdfdfd';
}

modeRadios.forEach(r=>r.addEventListener('change',updateUI));
algoRadios.forEach(r=>r.addEventListener('change',updateUI));

function flash(color){
  ioContainer.style.background=color+'33';
  setTimeout(()=>{ioContainer.style.background=color+'22';},300);
  setTimeout(()=>{ioContainer.style.background='#fdfdfd';},1000);
}

const logEl=document.getElementById('log');
function log(op,inputVal,outVal){
  const time=new Date().toLocaleTimeString();
  const msg=`[${time}] æ“ä½œ:${op} è¾“å…¥:${inputVal} â†’ è¾“å‡º:${outVal}`;
  logEl.innerHTML=`<div>${msg}</div>`+logEl.innerHTML;
}

function compute(){
  const algo = document.querySelector('input[name="mode"]:checked').value;
  const op = document.querySelector('input[name="operation"]:checked').value;
  let inputVal = mainInput.value.toUpperCase();
  try{
    if(algo==='ADM'){
      if(op==='encrypt'){
        if(!/^\d{4}$/.test(inputVal)){ alert('è¯·è¾“å…¥4ä½æ•°å­—'); return; }
        const res = admEncrypt(prefixInput.value,inputVal);
        prefixOutput.value='HT-'; output.value=res; flash('#4cafef'); log(op,prefixInput.value+'+'+inputVal,res);
      } else {
        if(!/^[A-HJ-NP-Z2-9]{6}$/.test(inputVal)){ alert('è¯·è¾“å…¥6ä½å­—ç¬¦'); return; }
        const {left,right}=admDecrypt(inputVal);
        prefixOutput.value=left; output.value=right; flash('#ff7043'); log(op,inputVal,left+'+'+right);
      }
    } else if(algo==='æ£®é‘«'){
      if(op==='encrypt'){
        if(!/^\d{2}[A-Z]{2}\d{4}$/.test(inputVal)){ alert('è¯·è¾“å…¥2æ•°å­—+2å­—æ¯+4æ•°å­—'); return; }
        const res = sensientEncrypt(inputVal,'ht1416');
        output.value=res; flash('#4cafef'); log(op,inputVal,res);
      } else {
        if(!/^[A-HJ-NP-Z2-9]{6}$/.test(inputVal)){ alert('è¯·è¾“å…¥6ä½å­—ç¬¦'); return; }
        const res = sensientDecrypt(inputVal,'ht1416');
        output.value=res; flash('#ff7043'); log(op,inputVal,res);
      }
    }
  }catch(e){ alert('æ“ä½œå¤±è´¥'); }
}

// åˆå§‹åŒ–
updateUI();
</script>
</body>
</html>
