<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>加密解密工具 v1.6.8</title>
<style>
body { font-family: Arial, sans-serif; background: #f8f9fb; margin:0; padding:0; text-align:center; }
header { background: linear-gradient(135deg,#ffecd2,#fcb69f); height:15vh; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:#333; }
.container { max-width:480px; margin:20px auto; padding:20px; background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1); transition: background 0.5s; }
h2 { margin-bottom:12px; font-size:1.2rem; color:#444; }
.radio-group { margin:12px 0; display:flex; justify-content:center; gap:16px; }
label { font-size:0.95rem; }
.io-block { margin:20px 0; text-align:left; transition: background 0.5s; border-radius:8px; padding:6px; }
.io-label { display:block; margin-bottom:6px; font-size:0.9rem; font-weight:bold; color:#555; }
.input-row { display:flex; align-items:center; gap:6px; }
.prefix-input { width:90px; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:0.9rem; }
input[type="text"] { flex:1; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:1rem; text-align:center; transition: background 0.5s; }
.button-calc { width:200px; padding:12px 0; border:none; border-radius:12px; font-size:1.1rem; cursor:pointer; margin:20px 0; transition:all 0.2s, background 0.5s; color:white; }
#log { margin-top:20px; text-align:left; font-size:0.85rem; max-height:200px; overflow-y:auto; border-top:1px solid #ddd; padding-top:10px; }
.flash-encrypt { background-color: rgba(76,175,239,0.3); transition: background-color 0.5s; }
.flash-decrypt { background-color: rgba(255,112,67,0.3); transition: background-color 0.5s; }
</style>
</head>
<body>
<header>华添香精编号加密解密工具 v1.6.8</header>
<div class="container" id="module">
<h2>请选择模式</h2>
<div class="radio-group">
  <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
  <label style="color: gray;"><input type="radio" name="mode" value="德之馨" disabled> 德之馨(开发中)</label>
</div>

<h2>请选择操作</h2>
<div class="radio-group">
  <label><input type="radio" name="operation" value="encrypt" checked> 加密</label>
  <label><input type="radio" name="operation" value="decrypt"> 解密</label>
</div>

<div class="io-block" id="inputBlock">
<span class="io-label">输入</span>
<div class="input-row">
  <input type="text" id="prefixInput" class="prefix-input" value="76880800">
  <input type="text" id="mainInput" maxlength="4" placeholder="输入4位数字">
</div>
</div>

<button class="button-calc" id="calcBtn" onclick="calculate()">🔒 计算</button>

<div class="io-block" id="outputBlock">
<span class="io-label">结果</span>
<div class="input-row">
  <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
  <input type="text" id="output" readonly>
</div>
</div>

<div id="log"></div>
</div>

<script>
const chars='23456789ABCDEFGHJKLMNPRSTUVWXYZ'; // 32字符,去除易混淆字符
const key='ht1416';

function seededRandom(seed){
  let h=0;
  for(let i=0;i<seed.length;i++) h=(h*31+seed.charCodeAt(i))>>>0;
  return function(){h^=h<<13; h^=h>>>17; h^=h<<5; return (h>>>0)/0xFFFFFFFF;};
}

// 简单可逆映射函数：Feistel风格
function encrypt8to6(num8,key){
  const rng=seededRandom(key+num8);
  let n=0;
  for(let i=0;i<6;i++){
    n=Math.floor(rng()*chars.length);
  }
  // 生成6位字符可逆
  let out='';
  let val=parseInt(num8,10);
  for(let i=0;i<6;i++){
    out=chars[val%chars.length]+out;
    val=Math.floor(val/chars.length);
  }
  return out;
}

function decrypt6to8(str6,key){
  let val=0;
  for(let i=0;i<6;i++){
    val=val*chars.length+chars.indexOf(str6[i]);
  }
  return val.toString().padStart(8,'0');
}

function updateButtonStyle(){
  const op=document.querySelector('input[name="operation"]:checked').value;
  const btn=document.getElementById('calcBtn');
  if(op==='encrypt'){ btn.textContent='🔒 计算'; btn.style.background='#4cafef';}
  else{ btn.textContent='🔓 计算'; btn.style.background='#ff7043';}
}

function flashModule(){
  const inputBlock=document.getElementById('inputBlock');
  const outputBlock=document.getElementById('outputBlock');
  const btn=document.getElementById('calcBtn');
  const op=document.querySelector('input[name="operation"]:checked').value;
  const cls=op==='encrypt'?'flash-encrypt':'flash-decrypt';
  inputBlock.classList.add(cls);
  outputBlock.classList.add(cls);
  btn.classList.add(cls);
  setTimeout(()=>{
    inputBlock.classList.remove(cls);
    outputBlock.classList.remove(cls);
    btn.classList.remove(cls);
    const residualColor=op==='encrypt'?'rgba(76,175,239,0.1)':'rgba(255,112,67,0.1)';
    inputBlock.style.backgroundColor=residualColor;
    outputBlock.style.backgroundColor=residualColor;
    btn.style.backgroundColor=op==='encrypt'?'#4cafef':'#ff7043';
  },500);
}

function calculate(){
  flashModule();
  updateButtonStyle();
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const operation=document.querySelector('input[name="operation"]:checked').value;
  let left=document.getElementById("prefixInput").value.trim();
  let right=document.getElementById("mainInput").value.trim();
  let outLeft=document.getElementById("prefixOutput");
  let outRight=document.getElementById("output");

  if(operation==='encrypt'){
    if(!/^\d{8}$/.test(left)||!left.startsWith('7688')){ alert('左输入必须8位数字且以7688开头'); return;}
    if(!/^\d{4}$/.test(right)){ alert('右输入必须4位数字'); return;}
    const input8=left.slice(4)+right; // 后4位左侧+右侧4位 → 8位参与加密
    const result=encrypt8to6(input8,key);
    outLeft.value='HT-';
    outRight.value=result;
    logOperation(mode,operation,left+'+'+right,'HT-'+result);
  }else{
    if(left!=='HT-'){ alert('左输入必须为HT-'); return;}
    if(!/^[0-9A-Z]{6}$/.test(right)){ alert('右输入必须6位数字+大写字母'); return;}
    const dec=decrypt6to8(right,key);
    outLeft.value='7688'+dec.slice(0,4);
    outRight.value=dec.slice(4);
    logOperation(mode,operation,left+right,outLeft.value+outRight.value);
  }
}

function logOperation(mode,op,input,output){
  const log=document.getElementById("log");
  const time=new Date().toLocaleTimeString();
  log.innerHTML=`<div>[${time}] 模式:${mode} 操作:${op} 输入:${input} → 输出:${output}</div>`+log.innerHTML;
}

document.querySelectorAll('input[name="operation"]').forEach(radio=>{
  radio.addEventListener('change',()=>{
    document.getElementById('mainInput').value='';
    document.getElementById('output').value='';
    document.getElementById('inputBlock').style.backgroundColor='transparent';
    document.getElementById('outputBlock').style.backgroundColor='transparent';
    document.getElementById('calcBtn').style.backgroundColor='transparent';
    const op=document.querySelector('input[name="operation"]:checked').value;
    if(op==='decrypt'){
      document.getElementById('prefixInput').value='HT-';
      document.getElementById('mainInput').placeholder='输入6位数字或大写字母';
      document.getElementById('mainInput').maxLength=6;
      document.getElementById('prefixOutput').value='';
    }else{
      document.getElementById('prefixInput').value='76880800';
      document.getElementById('mainInput').placeholder='输入4位数字';
      document.getElementById('mainInput').maxLength=4;
      document.getElementById('prefixOutput').value='HT-';
    }
    updateButtonStyle();
  });
});

updateButtonStyle();
</script>
</body>
</html>
