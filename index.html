<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>åæ·»é¦™ç²¾ç¼–å·åŠ è§£å¯†å·¥å…· v3.2</title>
<style>
body { font-family: Arial, sans-serif; background:#f0f2f5; margin:0; padding:0; text-align:center; }
header { background: linear-gradient(135deg,#ffecd2,#fcb69f); height:10vh; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:700; color:#333; }
.container { max-width:500px; margin:10px auto; padding:16px; background:#fff; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:14px; }
.description { font-size:0.8rem; color:#555; font-style:italic; background:#fafafa; padding:6px; border-radius:6px; text-align:left; }
.section-title { font-size:0.95rem; font-weight:700; margin:6px 0 4px 0; color:#333; text-align:left; }
.radio-group { display:flex; gap:12px; align-items:center; }
.io-block { display:flex; flex-direction:column; align-items:flex-start; gap:6px; width:100%; }
.io-label { font-weight:700; color:#444; }
.input-row { display:flex; gap:6px; width:100%; align-items:center; }
.prefix-input, input[type=text] { border-radius:6px; border:1px solid #ccc; padding:8px; font-size:1rem; text-align:center; }
.prefix-input { width:90px; }
input[type=text] { flex:1; }
.buttons { display:flex; justify-content:center; margin:8px 0; }
button { padding:8px 16px; border:none; border-radius:8px; font-size:0.95rem; cursor:pointer; transition:all .18s; display:flex; align-items:center; gap:6px; }
button:disabled { opacity:.5; cursor:not-allowed; }
.flash-container { border-radius:12px; padding:12px; background:#fdfdfd; transition:background .25s; }
#log { margin-top:8px; text-align:left; font-size:0.8rem; max-height:180px; overflow-y:auto; border-top:1px solid #eee; padding-top:6px; color:#333; }
.small { font-size:0.78rem; color:#666; text-align:left; }
</style>
</head>
<body>
<header>åæ·»é¦™ç²¾ç¼–å·åŠ è§£å¯†å·¥å…· v3.2</header>

<div class="container">
  <div class="description">
    <div><strong>è¯´æ˜</strong>ï¼šADM ä¿æŒåŸæœ‰ UI/é€»è¾‘ã€‚æ£®é‘«ï¼ˆSensientï¼‰ä¸º 8 ä½è¾“å…¥ï¼ˆæ ¼å¼ï¼š2æ•°å­—+2å­—æ¯+4æ•°å­—ï¼‰â†” 6 ä½ç¼–ç ï¼Œç§å­å›ºå®š <code>ht1416</code>ã€‚</div>
    <div class="small">åˆ‡æ¢ç®—æ³•åè¾“å…¥/è¾“å‡ºæ¡†ä¼šè‡ªåŠ¨é€‚é…å¯¹åº”æ ¡éªŒè§„åˆ™ã€‚</div>
  </div>

  <div class="section-title">ç®—æ³•é€‰æ‹©</div>
  <div class="radio-group">
    <label><input type="radio" name="algo" value="ADM" checked> ADM</label>
    <label><input type="radio" name="algo" value="SENSIENT"> æ£®é‘«</label>
  </div>

  <div class="section-title">æ“ä½œ</div>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
    <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
  </div>

  <div class="flash-container" id="ioContainer">
    <div class="io-block">
      <span class="io-label">è¾“å…¥</span>

      <!-- input row: for ADM show two inputs (prefixInput + mainInput); for SENSIENT show either single mainInput (encrypt) or prefixInput 'HT-' plus mainInput (decrypt) -->
      <div class="input-row" id="inputRow">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800" />
        <input type="text" id="mainInput" maxlength="4" placeholder="4ä½æ•°å­—" />
      </div>
      <div class="small" id="hint" style="display:block; margin-top:6px;"></div>
    </div>

    <div class="buttons">
      <button id="computeBtn" onclick="compute()">ğŸ”’ è®¡ç®—</button>
    </div>

    <div class="io-block">
      <span class="io-label">è¾“å‡º</span>
      <div class="input-row" id="outputRow">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly />
        <input type="text" id="output" readonly placeholder="6ä½å­—ç¬¦ / è§£å¯†ç»“æœ" />
      </div>
    </div>
  </div>

  <div id="log"></div>
</div>

<!-- è¯·æŠŠ ADM.js æ”¾åœ¨åŒç›®å½• -->
<script src="ADM.js"></script>
<script src="SENSIENT.js"></script>

<script>
/* UI behavior:
 - ADM: unchanged (encrypt: left=7688xxxx editable + right 4 digits; decrypt: left=HT- fixed, right 6-char; outputs: left HT- + right 6-char OR left 7688xxxx + right 4-digit)
 - SENSIENT: encrypt: single mainInput (8 chars: 2D 2L 4D) -> output: HT- (left) + 6char (right)
             decrypt: input left fixed HT-, right 6char -> output single combined 8-char shown in 'output' field (prefixOutput hidden)
*/

const algoRadios = document.querySelectorAll('input[name="algo"]');
const opRadios = document.querySelectorAll('input[name="operation"]');
const prefixInput = document.getElementById('prefixInput');
const mainInput = document.getElementById('mainInput');
const prefixOutput = document.getElementById('prefixOutput');
const output = document.getElementById('output');
const inputRow = document.getElementById('inputRow');
const outputRow = document.getElementById('outputRow');
const ioContainer = document.getElementById('ioContainer');
const hint = document.getElementById('hint');
const computeBtn = document.getElementById('computeBtn');
const logEl = document.getElementById('log');

function setToADM_encrypt(){
  prefixInput.style.display='inline-block';
  prefixInput.readOnly=false;
  prefixInput.value='76880800';
  mainInput.style.display='inline-block';
  mainInput.maxLength=4;
  mainInput.placeholder='4ä½æ•°å­—';
  mainInput.value='';
  prefixOutput.style.display='inline-block';
  prefixOutput.value='HT-';
  output.value='';
  hint.textContent='ADM åŠ å¯†ï¼šå·¦è¾“å…¥ 7688+å4ä½ï¼ˆå¯ç¼–è¾‘ï¼‰ï¼Œå³è¾“å…¥ 4 ä½æ•°å­—ã€‚';
  computeBtn.style.background='#4cafef';
  computeBtn.innerText='ğŸ”’ è®¡ç®—';
}

function setToADM_decrypt(){
  prefixInput.style.display='inline-block';
  prefixInput.readOnly=true;
  prefixInput.value='HT-';
  mainInput.style.display='inline-block';
  mainInput.maxLength=6;
  mainInput.placeholder='6ä½å­—ç¬¦';
  mainInput.value='';
  prefixOutput.style.display='inline-block';
  prefixOutput.value='';
  output.value='';
  hint.textContent='ADM è§£å¯†ï¼šå·¦ä¾§å›ºå®š HT-ï¼Œå³ä¾§è¾“å…¥ 6 ä½ç¼–ç ã€‚';
  computeBtn.style.background='#ff7043';
  computeBtn.innerText='ğŸ”“ è®¡ç®—';
}

function setToSensient_encrypt(){
  // input: single mainInput of length 8 (2D2L4D)
  prefixInput.style.display='none';
  mainInput.style.display='inline-block';
  mainInput.maxLength=8;
  mainInput.placeholder='2æ•°å­—+2å­—æ¯+4æ•°å­— (å¦‚: 08AB1234)';
  mainInput.value='';
  // output must show left HT- and right 6char
  prefixOutput.style.display='inline-block';
  prefixOutput.value='HT-';
  output.value='';
  hint.textContent='æ£®é‘« åŠ å¯†ï¼šè¾“å…¥æ ¼å¼ 2æ•°å­—+2å­—æ¯+4æ•°å­—ï¼ˆå…±8ä½ï¼‰ã€‚';
  computeBtn.style.background='#4cafef';
  computeBtn.innerText='ğŸ”’ è®¡ç®—';
}

function setToSensient_decrypt(){
  // input: left HT- fixed + right 6char
  prefixInput.style.display='inline-block';
  prefixInput.readOnly=true;
  prefixInput.value='HT-';
  mainInput.style.display='inline-block';
  mainInput.maxLength=6;
  mainInput.placeholder='6ä½ç¼–ç ';
  mainInput.value='';
  // output: single combined 8-char (we'll show in the single output textbox, and hide prefixOutput visually)
  prefixOutput.style.display='none';
  output.value='';
  hint.textContent='æ£®é‘« è§£å¯†ï¼šå·¦ä¾§å›ºå®š HT-ï¼Œå³ä¾§è¾“å…¥ 6 ä½ç¼–ç ï¼Œè¾“å‡ºæ¢å¤ 8 ä½åŸå§‹ã€‚';
  computeBtn.style.background='#ff7043';
  computeBtn.innerText='ğŸ”“ è®¡ç®—';
}

function updateUI(){
  const algo = document.querySelector('input[name="algo"]:checked').value;
  const op = document.querySelector('input[name="operation"]:checked').value;
  if(algo === 'ADM'){
    if(op === 'encrypt') setToADM_encrypt();
    else setToADM_decrypt();
  } else { // SENSIENT
    if(op === 'encrypt') setToSensient_encrypt();
    else setToSensient_decrypt();
  }
  ioContainer.style.background='#fdfdfd';
}

algoRadios.forEach(r => r.addEventListener('change', updateUI));
opRadios.forEach(r => r.addEventListener('change', updateUI));
updateUI();

function flash(color){
  ioContainer.style.background = color + '33';
  setTimeout(()=> ioContainer.style.background = color + '22', 260);
  setTimeout(()=> ioContainer.style.background = '#fdfdfd', 900);
}

function logEntry(op, inp, out){
  const t = new Date().toLocaleTimeString();
  const msg = `[${t}] æ“ä½œ:${op} è¾“å…¥:${inp} â†’ è¾“å‡º:${out}`;
  logEl.innerHTML = `<div>${msg}</div>` + logEl.innerHTML;
}

function compute(){
  const algo = document.querySelector('input[name="algo"]:checked').value;
  const op = document.querySelector('input[name="operation"]:checked').value;
  const inp = mainInput.value.trim().toUpperCase();
  try{
    if(algo === 'ADM'){
      if(op === 'encrypt'){
        if(!/^\d{4}$/.test(inp)){ alert('ADM åŠ å¯†ï¼šå³ä¾§è¯·è¾“å…¥4ä½æ•°å­—'); return; }
        const leftFull = prefixInput.value.trim();
        const code = admEncrypt(leftFull, inp); // ADM.js æä¾› admEncrypt
        prefixOutput.value='HT-';
        output.value = code;
        flash('#4cafef');
        logEntry('ADM encrypt', leftFull + '+' + inp, 'HT-' + code);
      } else {
        if(!/^[A-HJ-NP-Z2-9]{6}$/.test(inp)){ alert('ADM è§£å¯†ï¼šè¯·è¾“å…¥6ä½åˆæ³•ç¼–ç '); return; }
        const res = admDecrypt(inp); // ADM.js æä¾› admDecrypt -> {left,right}
        prefixOutput.value = res.left;
        output.value = res.right;
        flash('#ff7043');
        logEntry('ADM decrypt', 'HT-' + inp, res.left + '+' + res.right);
      }
    } else { // SENSIENT
      if(op === 'encrypt'){
        if(!/^\d{2}[A-Z]{2}\d{4}$/.test(inp)){ alert('æ£®é‘« åŠ å¯†ï¼šè¯·è¾“å…¥ 2æ•°å­—+2å­—æ¯+4æ•°å­—ï¼ˆä¾‹å¦‚ 08AB1234ï¼‰'); return; }
        const code = sensientEncrypt(inp, 'ht1416'); // SENSIENT.js æä¾› sensientEncrypt
        prefixOutput.value='HT-';
        output.value = code;
        flash('#4cafef');
        logEntry('Sensient encrypt', inp, 'HT-' + code);
      } else {
        if(!/^[A-HJ-NP-Z2-9]{6}$/.test(inp)){ alert('æ£®é‘« è§£å¯†ï¼šè¯·è¾“å…¥6ä½åˆæ³•ç¼–ç '); return; }
        const orig = sensientDecrypt(inp, 'ht1416'); // returns original 8-char
        // show the single combined result in output; prefixOutput hidden by UI
        output.value = orig;
        flash('#ff7043');
        logEntry('Sensient decrypt', 'HT-' + inp, orig);
      }
    }
  }catch(e){
    console.error(e);
    alert('æ“ä½œå¤±è´¥ï¼š' + (e && e.message ? e.message : 'æœªçŸ¥é”™è¯¯'));
  }
}
</script>

</body>
</html>
