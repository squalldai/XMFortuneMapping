<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>四位数字双射加密工具</title>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background: #f7f9fc; color: #333; }
h2 { text-align: center; color: #1976d2; }
label { font-weight: bold; margin-top: 10px; display: block; }
input { width: 100%; font-size: 1.2em; padding: 12px; margin: 5px 0 15px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
button { width: 48%; font-size: 1.2em; padding: 12px; margin: 5px 1%; border: none; border-radius: 6px; cursor: pointer; color: white; transition: background 0.3s; }
#encryptBtn { background-color: #1976d2; } #encryptBtn:hover { background-color: #1565c0; }
#decryptBtn { background-color: #ff9800; } #decryptBtn:hover { background-color: #fb8c00; }
#encryptInput { background-color: #e3f2fd; }
#decryptInput { background-color: #fff3e0; }
#history { margin-top: 20px; background: #ffffff; padding: 15px; border-radius: 8px; max-height: 250px; overflow-y: auto; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
.record { padding: 6px; border-bottom: 1px solid #eee; font-family: monospace; }
@media (max-width: 400px){ button { width: 100%; margin: 5px 0; } }
</style>
</head>
<body>

<h2>四位数字双射加密工具</h2>

<label>密钥（默认 ht1416）：</label>
<input type="text" id="keyInput" maxlength="20" placeholder="输入密钥或留空使用默认">

<label>原始四位数字：</label>
<input type="text" id="encryptInput" maxlength="4" placeholder="输入四位数字">

<label>加密结果 / 密文：</label>
<input type="text" id="decryptInput" maxlength="4" placeholder="解密结果显示">

<div style="text-align:center;">
    <button id="encryptBtn">加密 →</button>
    <button id="decryptBtn">解密 ←</button>
</div>

<div id="history">
    <strong>操作记录：</strong>
</div>

<script>
let defaultKey = 'ht1416';
let mapping = [];
let reverseMapping = [];

// 可控随机数生成器
function seededRandom(seed) {
    return function() {
        seed = (seed * 9301 + 49297) % 233280;
        return seed / 233280;
    };
}

// 生成10000个数字的置换表
function generatePermutation10000(key) {
    let arr = [];
    for(let i=0;i<10000;i++) arr.push(i);
    let seed = 0;
    for(let i=0;i<key.length;i++) seed += key.charCodeAt(i);
    const rand = seededRandom(seed);
    for(let i=arr.length-1;i>0;i--){
        let j = Math.floor(rand() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

// 初始化映射表
function initMapping() {
    let key = document.getElementById('keyInput').value.trim() || defaultKey;
    mapping = generatePermutation10000(key);
    reverseMapping = [];
    for(let i=0;i<10000;i++){
        reverseMapping[mapping[i]] = i;
    }
}

// 加解密函数
function encryptNumber(num) {
    let n = parseInt(num,10);
    if(n<0||n>9999) return '';
    return mapping[n].toString().padStart(4,'0');
}

function decryptNumber(num) {
    let n = parseInt(num,10);
    if(n<0||n>9999) return '';
    return reverseMapping[n].toString().padStart(4,'0');
}

// 历史记录
function addHistory(action,input,output){
    const historyDiv = document.getElementById('history');
    const record = document.createElement('div');
    record.className='record';
    record.textContent=`${action}: ${input} → ${output}`;
    historyDiv.prepend(record);
}

// 事件绑定
document.getElementById('encryptBtn').addEventListener('click',()=>{
    initMapping();
    const input=document.getElementById('encryptInput').value;
    if(!/^\d{4}$/.test(input)){ alert('请输入四位数字'); return; }
    const encrypted=encryptNumber(input);
    document.getElementById('decryptInput').value=encrypted;
    addHistory('加密',input,encrypted);
});

document.getElementById('decryptBtn').addEventListener('click',()=>{
    initMapping();
    const input=document.getElementById('decryptInput').value;
    if(!/^\d{4}$/.test(input)){ alert('请输入四位数字'); return; }
    const decrypted=decryptNumber(input);
    document.getElementById('encryptInput').value=decrypted;
    addHistory('解密',input,decrypted);
});
</script>

</body>
</html>
