<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>加密解密工具 v1.8.9</title>
<style>
  body {font-family: Arial, sans-serif; background: #f8f9fb; margin: 0; padding: 0; text-align: center;}
  header {background: linear-gradient(135deg, #ffecd2, #fcb69f); height:15vh; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:#333;}
  .container {max-width:480px; margin:20px auto; padding:20px; background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
  h2 {margin-bottom:12px; font-size:1.2rem; color:#444;}
  .radio-group {margin:12px 0; display:flex; justify-content:center; gap:16px;}
  label {font-size:0.95rem;}
  .io-block {margin:20px 0; text-align:left;}
  .io-label {display:block; margin-bottom:6px; font-size:0.9rem; font-weight:bold; color:#555;}
  .input-row {display:flex; align-items:center; gap:6px;}
  .prefix-input {width:90px; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:0.9rem;}
  input[type="text"] {flex:1; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:1rem; text-align:center;}
  .buttons {display:flex; justify-content:center; gap:20px; margin:20px 0;}
  button {padding:10px 20px; border:none; border-radius:10px; font-size:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:6px;}
  button.encrypt {background:#4cafef; color:white;}
  button.decrypt {background:#ff7043; color:white;}
  button:hover {transform:scale(1.05); opacity:0.9;}
  #log {margin-top:20px; text-align:left; font-size:0.85rem; max-height:200px; overflow-y:auto; border-top:1px solid #ddd; padding-top:10px;}
</style>
</head>
<body>
<header>华添香精编号加密解密工具 v1.8.9</header>
<div class="container">
  <h2>请选择模式</h2>
  <div class="radio-group">
    <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
    <label style="color: gray;"><input type="radio" name="mode" value="德之馨" disabled> 德之馨(开发中)</label>
  </div>

  <h2>请选择操作</h2>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> 加密</label>
    <label><input type="radio" name="operation" value="decrypt"> 解密</label>
  </div>

  <div class="io-block">
    <span class="io-label">输入</span>
    <div class="input-row">
      <input type="text" id="prefixInput" class="prefix-input" value="76880800">
      <input type="text" id="mainInput" maxlength="4" placeholder="输入4位数字">
    </div>
  </div>

  <div class="buttons">
    <button id="computeBtn" onclick="process()">🔒 计算</button>
  </div>

  <div class="io-block">
    <span class="io-label">输出</span>
    <div class="input-row">
      <input type="text" id="prefixOutput" class="prefix-input" value="HT-">
      <input type="text" id="output" readonly>
    </div>
  </div>

  <div id="log"></div>
</div>

<script>
// --- 算法保持不变 ---
const CHAR_TABLE = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 32字符防呆
const KEY = 'ht1416';
function encrypt6(left4, right4){
  const num=parseInt(left4+right4,10);
  let chars='';
  let tmp=num;
  for(let i=0;i<6;i++){chars=CHAR_TABLE[tmp%CHAR_TABLE.length]+chars; tmp=Math.floor(tmp/CHAR_TABLE.length);}
  return chars;
}
function decrypt6(chars){
  let num=0;
  for(let i=0;i<chars.length;i++){num=num*CHAR_TABLE.length+CHAR_TABLE.indexOf(chars[i]);}
  const str=num.toString().padStart(8,'0');
  const left4=str.slice(0,4);
  const right4=str.slice(4,8);
  return {left4,right4};
}

// --- UI 逻辑严格按照 1.8.7 ---
function resetUIForMode(mode){
  const mainInput=document.getElementById('mainInput');
  const prefixInput=document.getElementById('prefixInput');
  const prefixOutput=document.getElementById('prefixOutput');
  const output=document.getElementById('output');
  if(mode==='decrypt'){
    prefixInput.value='HT-';
    prefixInput.readOnly=true;
    mainInput.value='';
    mainInput.maxLength=6;
    output.value='';
    prefixOutput.value='';
    document.getElementById('computeBtn').innerText='🔓 计算';
    document.getElementById('computeBtn').className='decrypt';
  }else{
    prefixInput.value='76880800';
    prefixInput.readOnly=false;
    mainInput.value='';
    mainInput.maxLength=4;
    output.value='';
    prefixOutput.value='HT-';
    document.getElementById('computeBtn').innerText='🔒 计算';
    document.getElementById('computeBtn').className='encrypt';
  }
}

document.querySelectorAll('input[name="operation"]').forEach(r=>{
  r.addEventListener('change',()=>{
    const op=document.querySelector('input[name="operation"]:checked').value;
    resetUIForMode(op);
  });
});

function flashContainer(color){
  const container=document.querySelector('.container');
  container.style.transition='background 0.3s';
  container.style.background=color;
  setTimeout(()=>{container.style.background='#fff';},300);
}

function process(){
  const mode=document.querySelector('input[name="operation"]:checked').value;
  const leftInput=document.getElementById('prefixInput').value.trim();
  const mainInput=document.getElementById('mainInput').value.trim();
  const output=document.getElementById('output');
  const prefixOutput=document.getElementById('prefixOutput');

  if(mode==='encrypt'){
    if(!/^\d{4}$/.test(mainInput)){alert('请输入4位数字'); return;}
    const left4=leftInput.slice(-4);
    const right4=mainInput;
    const cipher=encrypt6(left4,right4);
    output.value=cipher;
    prefixOutput.value='HT-';
    flashContainer('rgba(76,175,239,0.2)');
  } else {
    if(!/^[A-Z2-9]{6}$/.test(mainInput)){alert('请输入6位字母数字组合'); return;}
    const res=decrypt6(mainInput);
    output.value=res.left4+res.right4;
    prefixOutput.value=res.right4;
    flashContainer('rgba(255,112,67,0.2)');
  }

  const log=document.getElementById('log');
  const time=new Date().toLocaleTimeString();
  log.innerHTML=`[${time}] 模式:${mode} 输入:${leftInput}+${mainInput} → 输出:${prefixOutput.value}${output.value}` + log.innerHTML;
}
</script>
</body>
</html>
