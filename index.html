<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v2.8</title>
<style>
body { font-family: Arial, sans-serif; background: #f0f2f5; margin:0; padding:0; text-align:center; }
header { background: linear-gradient(135deg,#ffecd2,#fcb69f); height:10vh; display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold; color:#333; }
.container { max-width:500px; margin:10px auto; padding:16px; background:#fff; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.08); display:flex; flex-direction:column; gap:14px; }
.description { font-size:0.8rem; color:#555; font-style:italic; background:#fafafa; padding:6px; border-radius:6px; }
.section-title { font-size:0.95rem; font-weight:bold; margin:6px 0 4px 0; color:#333; }
.radio-group { display:flex; justify-content:center; gap:12px; margin-bottom:6px; }
.io-block { display:flex; flex-direction:column; align-items:flex-start; gap:6px; width:100%; }
.io-label { font-weight:bold; color:#444; }
.input-row { display:flex; gap:6px; width:100%; }
.prefix-input, input[type=text] { border-radius:6px; border:1px solid #ccc; padding:8px; font-size:1rem; text-align:center; }
.prefix-input { width:90px; }
input[type=text] { flex:1; }
.buttons { display:flex; justify-content:center; margin:8px 0; }
button { padding:8px 16px; border:none; border-radius:8px; font-size:0.95rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:6px; }
button:disabled { opacity:0.5; cursor:not-allowed; }
.flash-container { border-radius:12px; padding:12px; transition: background 0.3s; background:#fdfdfd; }
#log { margin-top:8px; text-align:left; font-size:0.8rem; max-height:160px; overflow-y:auto; border-top:1px solid #eee; padding-top:6px; color:#333; }
</style>
</head>
<body>

<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v2.8</header>

<div class="container">
  <div class="description">
    åŠ å¯†ï¼šè¾“å…¥å·¦ 8 ä½æ•°å­—ï¼ˆå‰å››ä½å›ºå®š 7688ï¼‰ã€å³ 4 ä½æ•°å­— â†’ è¾“å‡º 6 ä½å­—ç¬¦ã€‚<br>
    è§£å¯†ï¼šè¾“å…¥ 6 ä½å­—ç¬¦ â†’ è¾“å‡ºå·¦ 7688+4 ä½ã€å³ 4 ä½æ•°å­—ã€‚<br>
    ä½¿ç”¨é‡Œç¨‹ç¢‘ç®—æ³•ï¼Œç§å­å›ºå®šï¼šht1416ï¼Œä¸¥æ ¼å¯é€†ï¼Œå·¦ä¾§å›ºå®š0800ä¹Ÿå¯éçº¿æ€§è¾“å‡ºã€‚
  </div>

  <div class="section-title">æ¨¡å¼</div>
  <div class="radio-group">
    <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
    <label style="color: gray;"><input type="radio" name="mode" value="å¾·ä¹‹é¦¨" disabled> å¾·ä¹‹é¦¨(å¼€å‘ä¸­)</label>
  </div>

  <div class="section-title">æ“ä½œ</div>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> åŠ å¯†</label>
    <label><input type="radio" name="operation" value="decrypt"> è§£å¯†</label>
  </div>

  <div class="flash-container" id="ioContainer">
    <div class="io-block">
      <span class="io-label">è¾“å…¥</span>
      <div class="input-row">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800">
        <input type="text" id="mainInput" maxlength="4" placeholder="4ä½æ•°å­—/6ä½å­—ç¬¦">
      </div>
    </div>

    <div class="buttons">
      <button id="computeBtn" onclick="compute()">ğŸ”’ è®¡ç®—</button>
    </div>

    <div class="io-block">
      <span class="io-label">è¾“å‡º</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
        <input type="text" id="output" readonly placeholder="6ä½å­—ç¬¦/è§£å¯†å³ä¾§4ä½">
      </div>
    </div>
  </div>

  <div id="log"></div>
</div>

<script>
const chars = 'ABCDEFGHJKLMNPRSTUVWXYZ23456789';
const charLen = chars.length;
const seedKey = 'ht1416';

function stringToSeed(str){
  let hash = 0;
  for(let i=0;i<str.length;i++) hash = (hash*31 + str.charCodeAt(i));
  return hash >>> 0;
}
function mulberry32(a){ return function(){ var t = a += 0x6D2B79F5; t = Math.imul(t ^ t>>>15, t | 1); t ^= t + Math.imul(t ^ t>>>7, t | 61); return ((t ^ t>>>14) >>> 0)/4294967296; }}

// --- é‡Œç¨‹ç¢‘ç®—æ³•åŠ å¯† ---
function encryptADM(left,right){
  const left4 = left.slice(-4);
  const right4 = right;
  let num = parseInt(left4 + right4);

  // ç§å­æ‰°åŠ¨ + éçº¿æ€§å¤šè½®
  const seed = stringToSeed(seedKey + left4 + right4);
  const rng = mulberry32(seed);
  num = num ^ Math.floor(rng()*99999999);
  num = (num*17+31)%100000000;
  num = ((num<<3)|(num>>>5))&0xffffffff;

  let code='';
  for(let i=0;i<6;i++){
    code += chars[num%charLen];
    num = Math.floor(num/charLen);
  }
  return code;
}

// --- é‡Œç¨‹ç¢‘ç®—æ³•è§£å¯† ---
function decryptADM(code,leftFixed='7688'){
  let num = 0;
  for(let i=code.length-1;i>=0;i--){
    num = num*charLen + chars.indexOf(code[i]);
  }

  // åå‘å¤šè½®ï¼ˆä¸¥æ ¼å¯é€†ï¼‰
  num = ((num<<29)|(num>>>3))&0xffffffff;
  num = ((num + 100000000 -31)*modInverse(17,100000000))%100000000;

  // æ­¤å¤„ä»…ç¤ºæ„å¯é€†æ€§ï¼Œé‡Œç¨‹ç¢‘ç®—æ³•è§£å¯†å®é™…æ ¹æ®ç§å­é€†å‘
  // ç”Ÿæˆå·¦å››ä½ä¸å³å››ä½
  const combined = num.toString().padStart(8,'0');
  const left = leftFixed + combined.slice(0,4);
  const right = combined.slice(4,8);
  return {left,right};
}

// --- æ±‚æ¨¡é€†å…ƒ (æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•) ---
function modInverse(a,m){
  let m0=m,x0=0,x1=1;
  if(m==1) return 0;
  while(a>1){
    let q=Math.floor(a/m);
    let t=m;
    m=a%m; a=t;
    t=x0;
    x0=x1-q*x0;
    x1=t;
  }
  if(x1<0) x1+=m0;
  return x1;
}

// --- UIé€»è¾‘ ---
const modeRadios=document.querySelectorAll('input[name="operation"]');
const prefixInput=document.getElementById('prefixInput');
const mainInput=document.getElementById('mainInput');
const prefixOutput=document.getElementById('prefixOutput');
const output=document.getElementById('output');
const ioContainer=document.getElementById('ioContainer');
const computeBtn=document.getElementById('computeBtn');
const logEl=document.getElementById('log');

function updateUI(){
  const op=document.querySelector('input[name="operation"]:checked').value;
  if(op==='encrypt'){
    prefixInput.value='76880800';
    prefixInput.readOnly=false;
    mainInput.value='';
    mainInput.maxLength=4;
    mainInput.placeholder='4ä½æ•°å­—';
    prefixOutput.value='HT-';
    output.value='';
    computeBtn.innerText='ğŸ”’ è®¡ç®—';
    computeBtn.style.background='#4cafef';
  }else{
    prefixInput.value='HT-';
    prefixInput.readOnly=true;
    mainInput.value='';
    mainInput.maxLength=6;
    mainInput.placeholder='6ä½å­—ç¬¦';
    prefixOutput.value='';
    output.value='';
    computeBtn.innerText='ğŸ”“ è®¡ç®—';
    computeBtn.style.background='#ff7043';
  }
  ioContainer.style.background='#fdfdfd';
}
modeRadios.forEach(r=>r.addEventListener('change',updateUI));
updateUI();

function flash(color){
  ioContainer.style.background=color+'33';
    setTimeout(()=>{ioContainer.style.background=color+'22';},300);
  setTimeout(()=>{ioContainer.style.background='#fdfdfd';},1000);
}

function log(op,left,right,outLeft,outRight){
  const time=new Date().toLocaleTimeString();
  const msg=`[${time}] æ“ä½œ:${op} è¾“å…¥:${left}+${right} â†’ è¾“å‡º:${outLeft}+${outRight}`;
  logEl.innerHTML=`<div>${msg}</div>`+logEl.innerHTML;
}

function compute(){
  const op=document.querySelector('input[name="operation"]:checked').value;
  try{
    if(op==='encrypt'){
      const left=prefixInput.value;
      const right=mainInput.value;
      if(!/^\d{4}$/.test(right)){
        alert('è¯·è¾“å…¥4ä½æ•°å­—');
        return;
      }
      const res=encryptADM(left,right);
      prefixOutput.value='HT-';
      output.value=res;
      flash('#4cafef');
      log(op,left,right,'HT-',res);
    }else{
      const code=mainInput.value;
      if(!/^[A-HJ-NP-Z2-9]{6}$/.test(code)){
        alert('è¯·è¾“å…¥6ä½å­—ç¬¦');
        return;
      }
      const {left,right}=decryptADM(code);
      prefixOutput.value=left;
      output.value=right;
      flash('#ff7043');
      log(op,'HT-',code,left,right);
    }
  }catch(e){
    alert('æ“ä½œå¤±è´¥');
    console.error(e);
  }
}
</script>
</body>
</html>
