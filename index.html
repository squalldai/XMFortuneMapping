<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>加密解密工具 v1.8.4</title>
<style>
:root{
  --blue:#4cafef;
  --orange:#ff7043;
  --bg:#f0f2f5;
  --card:#ffffff;
  --text:#333;
  --muted:#555;
  --hint:#777;
  --shadow:0 4px 12px rgba(0,0,0,0.1);
}
*{box-sizing:border-box}
body{
  font-family:Arial,Helvetica,sans-serif;
  background:var(--bg);
  margin:0; padding:0; text-align:center; color:var(--text);
}
header{
  background:linear-gradient(135deg,#ffecd2,#fcb69f);
  height:12vh; min-height:64px;
  display:flex; align-items:center; justify-content:center;
  font-size:1.95rem; font-weight:700; color:#333;
  box-shadow:0 2px 8px rgba(0,0,0,0.1);
}
.container{
  max-width:480px; margin:10px auto; padding:12px 16px;
  background:var(--card); border-radius:16px; box-shadow:var(--shadow);
}
.info-module{
  background:rgba(240,240,240,0.8);
  border-radius:12px; padding:12px; text-align:left;
  font-size:0.86rem; font-style:italic; color:#444; margin-bottom:12px;
}
h2{ margin:10px 0 6px; font-size:1.08rem; color:#444; }
.radio-group{
  margin:6px 0 12px; display:flex; justify-content:center; gap:14px; flex-wrap:wrap;
}
label{ font-size:0.92rem; color:#333; }
.calc-container{
  border-radius:14px; padding:10px; transition:background 0.5s, box-shadow 0.3s;
  backdrop-filter:saturate(120%) blur(2px);
}
.io-block{
  margin:6px 0; text-align:left; border-radius:10px; padding:8px; transition:background 0.5s;
}
.io-label{
  display:block; margin-bottom:6px; font-size:0.88rem; font-weight:700; color:#555;
}
.input-row{ display:flex; align-items:center; gap:8px; }
.prefix-input{
  width:110px; padding:8px; border:1px solid #d0d5dd; border-radius:8px; font-size:0.9rem; text-align:center;
  background:#fafafa;
}
input[type="text"]{
  flex:1; padding:10px; border:1px solid #d0d5dd; border-radius:8px; font-size:1.02rem; text-align:center;
  transition:box-shadow .2s, border-color .2s;
}
input[type="text"]:focus{ outline:none; border-color:#b7c9ff; box-shadow:0 0 0 3px rgba(71,124,255,0.15); }
.button-calc{
  width:230px; padding:12px 0; border:none; border-radius:12px; font-size:1.08rem;
  cursor:pointer; margin:12px auto; color:#fff; display:block; transition:transform .15s, opacity .2s, background .2s;
}
.button-calc:hover{ transform:translateY(-1px); opacity:.95; }
#log{
  margin-top:16px; text-align:left; font-size:0.85rem; max-height:200px; overflow-y:auto; border-top:1px solid #ddd; padding-top:8px;
}
</style>
</head>
<body>
<header>华添香精编号加密解密工具 v1.8.4</header>
<div class="container">
  <div class="info-module">
    当前仅支持ADM模式。输入左边8位数字（前4位固定7688），右边4位数字进行加密。计算按钮点击后输出6位数字+字母。解密输入6位数字+字母可恢复原左8位+右4位数字。
  </div>
  <h2>请选择模式</h2>
  <div class="radio-group">
    <label><input type="radio" name="mode" value="ADM" checked> ADM</label>
    <label style="color: gray;"><input type="radio" name="mode" value="德之馨" disabled> 德之馨(开发中)</label>
  </div>
  <h2>请选择操作</h2>
  <div class="radio-group">
    <label><input type="radio" name="operation" value="encrypt" checked> 加密</label>
    <label><input type="radio" name="operation" value="decrypt"> 解密</label>
  </div>
  <div class="calc-container" id="calcContainer">
    <div class="io-block">
      <span class="io-label">输入数字</span>
      <div class="input-row">
        <input type="text" id="prefixInput" class="prefix-input" value="76880800">
        <input type="text" id="mainInput" maxlength="4" placeholder="右边4位数字">
      </div>
    </div>
    <button class="button-calc" id="calcBtn" onclick="process()">🔒 计算</button>
    <div class="io-block">
      <span class="io-label">结果</span>
      <div class="input-row">
        <input type="text" id="prefixOutput" class="prefix-input" value="HT-" readonly>
        <input type="text" id="output" readonly>
      </div>
    </div>
  </div>
  <div id="log"></div>
</div>
<script>
// ---- 工具函数 ----
function seededRandom(seed){
  let h=0; for(let i=0;i<seed.length;i++){h=(h*31+seed.charCodeAt(i))>>>0;}
  return function(){h^=h<<13; h^=h>>>17; h^=h<<5; return (h>>>0)/0xFFFFFFFF;}
}
function shuffleArray(arr, rng){
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(rng()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function base32Encode(num, length){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; //无 I,O,1,0
  let res=''; for(let i=0;i<length;i++){ res=chars[num%chars.length]+res; num=Math.floor(num/chars.length);}
  return res;
}
function base32Decode(str){
  const chars='ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
  let num=0;
  for(let i=0;i<str.length;i++){ num=num*chars.length+chars.indexOf(str[i]);}
  return num;
}
// ---- 加解密 ----
const key="ht1416";
const rng=seededRandom(key);
const permutation=shuffleArray([...Array(1000000).keys()], rng);

function feistelEncrypt(n){
  let left=Math.floor(n/10000), right=n%10000;
  for(let i=0;i<4;i++){
    let temp=right;
    right=left^(Math.floor((right*key.length+i)%10000));
    left=temp;
  }
  return left*10000+right;
}
function feistelDecrypt(n){
  let left=Math.floor(n/10000), right=n%10000;
  for(let i=3;i>=0;i--){
    let temp=left;
    left=right^(Math.floor((left*key.length+i)%10000));
    right=temp;
  }
  return left*10000+right;
}
function process(){
  const mode=document.querySelector('input[name="mode"]:checked').value;
  const op=document.querySelector('input[name="operation"]:checked').value;
  let prefixInput=document.getElementById('prefixInput').value.trim();
  let mainInput=document.getElementById('mainInput').value.trim();
  const output=document.getElementById('output');
  const prefixOutput=document.getElementById('prefixOutput');
  const calcContainer=document.getElementById('calcContainer');
  if(op==='encrypt'){
    if(!/^\d{8}$/.test(prefixInput)||!prefixInput.startsWith('7688')){ alert("左输入必须8位且7688开头"); return;}
    if(!/^\d{4}$/.test(mainInput)){alert("右输入必须4位数字"); return;}
    let num=parseInt(prefixInput.slice(4)+mainInput,10);
    let enc=feistelEncrypt(num);
    let b32=base32Encode(enc,6);
    prefixOutput.value='HT-'; output.value=b32;
    calcContainer.style.background='rgba(76,175,239,0.2)';
    document.getElementById('calcBtn').style.background='var(--blue)'; document.getElementById('calcBtn').innerText='🔒 计算';
  }else{
    if(!/^[A-Z2-9]{6}$/.test(mainInput)){alert("解密输入右边必须6位字母+数字"); return;}
    let num=base32Decode(mainInput);
    let dec=feistelDecrypt(num);
    let left4=String(Math.floor(dec/10000)).padStart(4,'0');
    let right4=String(dec%10000).padStart(4,'0');
    prefixOutput.value='7688'+left4; output.value=right4;
    calcContainer.style.background='rgba(255,112,67,0.15)';
    document.getElementById('calcBtn').style.background='var(--orange)'; document.getElementById('calcBtn').innerText='🔓 计算';
  }
  // log
  const log=document.getElementById('log');
  const time=new Date().toLocaleTimeString();
  log.innerHTML=`<div>[${time}] 模式:${mode} 操作:${op} 输入:${prefixInput}+${mainInput} → 输出:${prefixOutput.value}+${output.value}</div>`+log.innerHTML;
  setTimeout(()=>{calcContainer.style.background='transparent';},500);
}
</script>
</body>
</html>
