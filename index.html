<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>4位数字加密解密v3</title>
<style>
  body{margin:0;padding:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:#f2f2f7}
  .wrap{max-width:480px;margin:20px auto;padding:0 12px}
  .card{background:#fff;border-radius:14px;padding:16px;box-shadow:0 1px 4px rgba(0,0,0,.1);margin-bottom:16px}
  h1{text-align:center;font-size:20px;margin:0 0 14px}
  label{display:block;margin-bottom:6px;font-weight:600}
  input[type=text]{width:100%;border:1px solid #ddd;border-radius:10px;padding:12px;font-size:18px;box-sizing:border-box}
  .btns{display:flex;justify-content:center;gap:12px;margin:16px 0}
  button{flex:1;padding:12px;font-size:18px;border-radius:12px;border:none;font-weight:600;cursor:pointer}
  .btnEnc{background:#007aff;color:#fff}
  .btnDec{background:#34c759;color:#fff}
  .block{padding:16px;border-radius:12px;margin-bottom:12px}
  .encBlock{background:#e7f0ff}
  .decBlock{background:#e6fbea}
  .out{font:600 20px/1.4 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;text-align:center;margin-top:10px}
  .msg{text-align:center;font-size:14px;margin-top:6px;color:#666}
  .keyBox{margin-bottom:14px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>4位数字加密/解密</h1>
    <div class="keyBox">
      <label for="key">密钥</label>
      <input id="key" type="text" value="ht1416">
    </div>

    <div class="block encBlock">
      <label for="plain">原始数字</label>
      <input id="plain" type="text" inputmode="numeric" maxlength="4" placeholder="如：0420">
      <div class="out" id="encOut"></div>
    </div>

    <div class="btns">
      <button class="btnEnc" id="encBtn">加密 →</button>
      <button class="btnDec" id="decBtn">← 解密</button>
    </div>

    <div class="block decBlock">
      <label for="cipher">加密数字</label>
      <input id="cipher" type="text" inputmode="numeric" maxlength="4" placeholder="如：7391">
      <div class="out" id="decOut"></div>
    </div>

    <div id="msg" class="msg"></div>
  </div>
</div>

<script>
  const $ = id => document.getElementById(id);

  // 校验
  function isFourDigits(s){ return /^\d{1,4}$/.test(s); }
  function pad4(s){ return s.toString().padStart(4,'0'); }
  function showMsg(txt,type='info'){ $('msg').textContent=txt; }

  // 随机数生成器（密钥种子）
  function rngFromKey(key){
    let seed = 2166136261>>>0;
    for (let i=0;i<key.length;i++){
      seed ^= key.charCodeAt(i);
      seed = Math.imul(seed,16777619)>>>0;
    }
    let state = seed;
    return ()=>{state^=state<<13;state>>>=0;state^=state>>17;state>>>=0;state^=state<<5;state>>>=0;
      state=(Math.imul(state,1664525)+1013904223)>>>0;
      return state/2**32;}
  }

  // 构建置换表
  function buildPermutation(key){
    const rand=rngFromKey(key);
    const arr=new Array(10000);
    for(let i=0;i<10000;i++) arr[i]=pad4(i);
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(rand()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  function invertPermutation(arr){
    const inv={};for(let i=0;i<arr.length;i++) inv[arr[i]]=pad4(i);return inv;
  }

  let cache={key:null,perm:null,inv:null};
  function ensureTables(key){
    if(cache.key!==key){
      const perm=buildPermutation(key);
      cache={key,perm,inv:invertPermutation(perm)};
    }
    return cache;
  }

  function encrypt(num,key){
    if(!isFourDigits(num)) throw new Error('请输入1~4位数字');
    const {perm}=ensureTables(key);
    return perm[parseInt(num,10)];
  }
  function decrypt(num,key){
    if(!isFourDigits(num)) throw new Error('请输入1~4位数字');
    const {inv}=ensureTables(key);
    const res=inv[pad4(num)];
    if(res==null) throw new Error('无对应映射');
    return res;
  }

  $('encBtn').addEventListener('click',()=>{
    try{
      const key=$('key').value;
      const v=$('plain').value.trim();
      const out=encrypt(v,key);
      $('encOut').textContent=out;
      $('cipher').value=out;
      showMsg(`加密成功：${pad4(v)} → ${out}`);
    }catch(e){showMsg(e.message);}
  });

  $('decBtn').addEventListener('click',()=>{
    try{
      const key=$('key').value;
      const v=$('cipher').value.trim();
      const out=decrypt(v,key);
      $('decOut').textContent=out;
      $('plain').value=out;
      showMsg(`解密成功：${pad4(v)} → ${out}`);
    }catch(e){showMsg(e.message);}
  });
</script>
</body>
</html>
