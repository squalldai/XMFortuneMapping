<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å››ä½æ•°å­—åŠ å¯†è§£å¯†</title>
<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    margin: 0; padding: 15px;
    background: #f5f7fa; color: #333;
}
h2 { text-align: center; color: #1976d2; margin-bottom: 8px; }
.description {
    text-align: center; color: #555;
    font-size: 0.95em; margin-bottom: 20px;
    line-height: 1.5;
}
.card {
    background: #fff; border-radius: 12px;
    padding: 15px; margin-bottom: 15px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
}
label { font-weight: 600; display: block; margin-bottom: 5px; }
input {
    width: 100%; font-size: 1.3em; padding: 10px;
    margin-bottom: 6px; border: 1px solid #ccc; border-radius: 6px;
    text-align: center; letter-spacing: 3px;
}
input:focus { outline: none; border-color: #1976d2; }
input.error { border-color: #e53935; background: #ffebee; }
.helper { font-size: 0.9em; color: #999; margin-bottom: 8px; }
.helper.error { color: #e53935; }

button {
    font-size: 1.05em; padding: 10px 14px;
    border: none; border-radius: 6px; cursor: pointer;
    color: white; transition: background 0.2s;
}
#encryptBtn { background-color: #1976d2; }
#encryptBtn:active { background-color: #1565c0; }
#decryptBtn { background-color: #ff9800; }
#decryptBtn:active { background-color: #fb8c00; }

.buttons { display: flex; justify-content: space-between; margin: 10px 0; }

.result-container { display: flex; align-items: center; gap: 8px; }
.result-container input { flex: 1; }
.copy-btn {
    background: #4caf50; min-width: 50px;
}
.copy-btn:active { background: #43a047; }

#history { margin-top: 10px; max-height: 220px; overflow-y: auto; }
.record {
    padding: 6px 8px; border-bottom: 1px solid #eee;
    display: flex; justify-content: space-between; align-items: center;
    font-family: monospace; cursor: pointer;
}
.record span.tag {
    padding: 2px 6px; border-radius: 4px; font-size: 0.8em; color: #fff;
    margin-right: 10px;
}
.record .encrypt { background: #1976d2; }
.record .decrypt { background: #ff9800; }
.record:hover { background: #f9f9f9; }

#copyMsg {
    font-size: 0.85em; color: #4caf50;
    margin-left: 4px; visibility: hidden;
}
</style>
</head>
<body>

<h2>ğŸ” å››ä½æ•°å­—åŠ å¯†è§£å¯†</h2>
<p class="description">
è¾“å…¥ä»»æ„å››ä½æ•°å­—ï¼Œå³å¯é€šè¿‡å›ºå®šå¯†é’¥ <b>ht1416</b> åŠ å¯†ä¸ºå¦ä¸€ç»„å”¯ä¸€å››ä½æ•°ã€‚<br>
åŠ å¯†ç»“æœå¯éšæ—¶è§£å¯†å›åŸå§‹æ•°å­—ï¼Œæ“ä½œç®€ä¾¿ï¼Œé€‚åˆæ•°å­—å®‰å…¨ä¼ è¾“åœºæ™¯ã€‚
</p>

<div class="card">
    <label>è¯·è¾“å…¥å››ä½æ•°å­—ï¼š</label>
    <input type="tel" id="encryptInput" maxlength="4" placeholder="ä¾‹å¦‚ï¼š1234" inputmode="numeric">
    <div id="inputHelper" class="helper">ä»…æ”¯æŒ 0-9 çš„å››ä½æ•°å­—</div>
</div>

<div class="card">
    <div class="buttons">
        <button id="decryptBtn">ğŸ”“ è§£å¯†</button>
        <button id="encryptBtn">ğŸ”’ åŠ å¯†</button>
    </div>
    <label>ç»“æœï¼š</label>
    <div class="result-container">
        <input type="text" id="decryptInput" readonly placeholder="ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ">
        <button class="copy-btn" id="copyBtn">ğŸ“‹</button>
        <span id="copyMsg">å·²å¤åˆ¶</span>
    </div>
</div>

<div class="card">
    <strong>ğŸ“œ æ“ä½œè®°å½•ï¼š</strong>
    <div id="history"></div>
</div>

<script>
let defaultKey = 'ht1416';
let mapping = [], reverseMapping = [];

function seededRandom(seed) {
    return function() {
        seed = (seed * 9301 + 49297) % 233280;
        return seed / 233280;
    };
}

function generatePermutation10000(key) {
    let arr = [];
    for(let i=0;i<10000;i++) arr.push(i);
    let seed = 0;
    for(let i=0;i<key.length;i++) seed += key.charCodeAt(i);
    const rand = seededRandom(seed);
    for(let i=arr.length-1;i>0;i--){
        let j = Math.floor(rand() * (i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

function initMapping() {
    mapping = generatePermutation10000(defaultKey);
    reverseMapping = [];
    for(let i=0;i<10000;i++) reverseMapping[mapping[i]] = i;
}

function normalizeInput(num) {
    return num.padStart(4,'0');
}

function validateInput(value) {
    const helper = document.getElementById("inputHelper");
    const inputBox = document.getElementById("encryptInput");
    if (!/^\d{1,4}$/.test(value)) {
        inputBox.classList.add("error");
        helper.textContent = "âŒ è¯·è¾“å…¥ 0-9 çš„å››ä½æ•°å­—";
        helper.classList.add("error");
        return false;
    } else {
        inputBox.classList.remove("error");
        helper.textContent = "âœ” å¯ä»¥è¿›è¡ŒåŠ å¯†æˆ–è§£å¯†";
        helper.classList.remove("error");
        return true;
    }
}

function encryptNumber(num) {
    let n = parseInt(num,10);
    if(n<0||n>9999) return '';
    return mapping[n].toString().padStart(4,'0');
}
function decryptNumber(num) {
    let n = parseInt(num,10);
    if(n<0||n>9999) return '';
    return reverseMapping[n].toString().padStart(4,'0');
}

function addHistory(action,input,output){
    const historyDiv = document.getElementById('history');
    const record = document.createElement('div');
    record.className='record';
    const tag = document.createElement('span');
    tag.className = 'tag ' + (action==="åŠ å¯†"?"encrypt":"decrypt");
    tag.textContent = action;
    record.appendChild(tag);
    const text = document.createElement('span');
    text.textContent = `${input} â†’ ${output}`;
    record.appendChild(text);
    record.addEventListener('click',()=>{
        document.getElementById('encryptInput').value=input;
        document.getElementById('decryptInput').value=output;
    });
    historyDiv.prepend(record);
}

// äº‹ä»¶ç»‘å®š
document.getElementById('encryptInput').addEventListener('input', (e)=>{
    e.target.value = e.target.value.replace(/\D/g,''); // åªä¿ç•™æ•°å­—
    validateInput(e.target.value);
});

document.getElementById('encryptBtn').addEventListener('click',()=>{
    initMapping();
    let input=document.getElementById('encryptInput').value;
    if(!validateInput(input)) return;
    input = normalizeInput(input);
    const encrypted=encryptNumber(input);
    document.getElementById('decryptInput').value=encrypted;
    addHistory('åŠ å¯†',input,encrypted);
});

document.getElementById('decryptBtn').addEventListener('click',()=>{
    initMapping();
    let input=document.getElementById('encryptInput').value;
    if(!validateInput(input)) return;
    input = normalizeInput(input);
    const decrypted=decryptNumber(input);
    document.getElementById('decryptInput').value=decrypted;
    addHistory('è§£å¯†',input,decrypted);
});

// å¤åˆ¶åŠŸèƒ½
document.getElementById('copyBtn').addEventListener('click',()=>{
    const result = document.getElementById('decryptInput').value;
    if(result){
        navigator.clipboard.writeText(result).then(()=>{
            const msg = document.getElementById('copyMsg');
            msg.style.visibility = "visible";
            setTimeout(()=> msg.style.visibility = "hidden", 1500);
        });
    }
});
</script>

</body>
</html>
