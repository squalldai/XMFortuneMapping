<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v1.8.8</title>
<style>
body {font-family: Arial,sans-serif; background:#f8f9fb; margin:0; padding:0; text-align:center;}
header {background: linear-gradient(135deg,#ffecd2,#fcb69f); height:15vh; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:#333;}
.container {max-width:480px; margin:10px auto; padding:15px; background:#fff; border-radius:16px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
h2 {margin:10px 0; font-size:1.1rem; color:#444;}
.radio-group {margin:8px 0; display:flex; justify-content:center; gap:16px;}
label {font-size:0.95rem;}
.io-block {margin:15px 0; text-align:left;}
.io-label {display:block; margin-bottom:4px; font-size:0.9rem; font-weight:bold; color:#555;}
.input-row {display:flex; align-items:center; gap:6px;}
.prefix-input {width:90px; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:0.9rem;}
input[type="text"] {flex:1; padding:8px; border:1px solid #ccc; border-radius:6px; font-size:1rem; text-align:center;}
.buttons {display:flex; justify-content:center; gap:20px; margin:15px 0;}
button {padding:10px 20px; border:none; border-radius:10px; font-size:1rem; cursor:pointer; transition:all 0.2s; display:flex; align-items:center; gap:6px;}
button.encrypt {background:#4cafef; color:white;}
button.decrypt {background:#ff7043; color:white;}
button:hover {transform:scale(1.05); opacity:0.9;}
#log {margin-top:15px; text-align:left; font-size:0.85rem; max-height:200px; overflow-y:auto; border-top:1px solid #ddd; padding-top:8px;}
.flash {transition: background-color 0.3s ease;}
</style>
</head>
<body>
<header>åæ·»é¦™ç²¾ç¼–å·åŠ å¯†è§£å¯†å·¥å…· v1.8.8</header>

<div class="container" id="mainContainer">
<h2>è¯´æ˜</h2>
<p style="font-size:0.85rem; color:#555; font-style:italic; background:#f0f0f0; padding:6px; border-radius:6px;">
ADMæ¨¡å¼ï¼šè¾“å…¥7688å¼€å¤´å¯ç¼–è¾‘8ä½æ•°å­—+å³ä¾§4ä½æ•°å­— â†’ è¾“å‡º6ä½æ•°å­—å­—æ¯ç»„åˆï¼ˆé˜²å‘†è®¾è®¡å»æ‰I,O,0,1ï¼‰ã€‚è§£å¯†ä¸¥æ ¼å¯é€†ï¼Œä¿è¯åŸè¾“å…¥å¯è¿˜åŸã€‚
</p>

<h2>è¯·é€‰æ‹©æ¨¡å¼</h2>
<div class="radio-group">
<label><input type="radio" name="mode" value="ADM" checked> ADM</label>
<label style="color: gray;"><input type="radio" name="mode" value="å¾·ä¹‹é¦¨" disabled> å¾·ä¹‹é¦¨(å¼€å‘ä¸­)</label>
</div>

<h2>è¯·é€‰æ‹©æ“ä½œ</h2>
<div class="radio-group">
<label><input type="radio" name="operation" value="encrypt" checked onchange="updateUI()"> åŠ å¯†</label>
<label><input type="radio" name="operation" value="decrypt" onchange="updateUI()"> è§£å¯†</label>
</div>

<div class="io-block" id="ioContainer">
<span class="io-label">è¾“å…¥</span>
<div class="input-row">
<input type="text" id="prefixInput" class="prefix-input" value="76880800">
<input type="text" id="mainInput" maxlength="4" placeholder="è¾“å…¥4ä½æ•°å­—">
</div>
</div>

<div class="buttons">
<button id="calcButton" class="encrypt" onclick="process()">ğŸ”’ è®¡ç®—</button>
</div>

<div class="io-block">
<span class="io-label">ç»“æœ</span>
<div class="input-row">
<input type="text" id="prefixOutput" class="prefix-input" value="HT-">
<input type="text" id="output" readonly>
</div>
</div>

<div id="log"></div>
</div>

<script>
const safeChars='23456789ABCDEFGHJKLMNPQRSTUVWXYZ';

function seededRandom(seed){
    let h=0;
    for(let i=0;i<seed.length;i++){h=(h*31+seed.charCodeAt(i))>>>0;}
    return function(){
        h^=h<<13; h^=h>>>17; h^=h<<5;
        return (h>>>0)/0xFFFFFFFF;
    }
}

function shuffle6(arr, seed){
    const rng=seededRandom(seed);
    let result=arr.slice();
    for(let i=result.length-1;i>0;i--){
        const j=Math.floor(rng()*(i+1));
        [result[i],result[j]]=[result[j],result[i]];
    }
    return result;
}

function unshuffle6(shuffled, seed){
    const rng=seededRandom(seed);
    let n=shuffled.length;
    let swaps=[];
    for(let i=n-1;i>0;i--){
        const j=Math.floor(rng()*(i+1));
        swaps.push([i,j]);
    }
    let arr=shuffled.slice();
    for(let k=swaps.length-1;k>=0;k--){
        const [i,j]=swaps[k];
        [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
}

function encryptADM(prefix, main){
    const key=prefix.slice(-4)+main;
    const seed='ht1416'+key;
    let arr=[0,1,2,3,4,5];
    let shuffled=shuffle6(arr, seed);
    let output='';
    for(let i of shuffled){
        output+=safeChars[(parseInt(main[i])+i+seed.charCodeAt(0))%safeChars.length];
    }
    return output;
}

function decryptADM(cipher, prefix){
    const seed='ht1416'+prefix.slice(-4)+'0000';
    let arr=[];
    for(let i=0;i<6;i++){
        let idx=safeChars.indexOf(cipher[i]);
        if(idx<0){alert("è§£å¯†å­—ç¬¦éæ³•ï¼"); return "";}
        arr.push(idx);
    }
    let unshuffled=unshuffle6(arr, seed);
    return prefix+unshuffled.slice(2,6).join('');
}

function updateUI(){
    const op=document.querySelector('input[name="operation"]:checked').value;
    const prefixInput=document.getElementById('prefixInput');
    const mainInput=document.getElementById('mainInput');
    const outPrefix=document.getElementById('prefixOutput');
    const outText=document.getElementById('output');
    const btn=document.getElementById('calcButton');

    if(op==='encrypt'){
        prefixInput.value='76880800';
        prefixInput.disabled=false;
        mainInput.value='';
        mainInput.maxLength=4;
        mainInput.placeholder='è¾“å…¥4ä½æ•°å­—';
        btn.innerHTML='ğŸ”’ è®¡ç®—';
        btn.classList.remove('decrypt');
        btn.classList.add('encrypt');
    }else{
        prefixInput.value='HT-';
        prefixInput.disabled=true;
        mainInput.value='';
        mainInput.maxLength=6;
        mainInput.placeholder='è¾“å…¥6ä½å­—æ¯æ•°å­—';
        btn.innerHTML='ğŸ”“ è®¡ç®—';
        btn.classList.remove('encrypt');
        btn.classList.add('decrypt');
    }

    outPrefix.value='HT-';
    outText.value='';
    document.getElementById('ioContainer').style.background='transparent';
}

function flashContainer(color){
    const container=document.getElementById('mainContainer');
    container.style.transition='background-color 0.3s ease';
    container.style.backgroundColor=color;
    setTimeout(()=>{
        container.style.backgroundColor=color.replace(/0\.3/,'0.1'); 
    },300);
}

function process(){
    const mode=document.querySelector('input[name="mode"]:checked').value;
    const operation=document.querySelector('input[name="operation"]:checked').value;
    let prefix=document.getElementById('prefixInput').value.trim();
    let main=document.getElementById('mainInput').value.trim();
    let outPrefix=document.getElementById('prefixOutput');
    let outText=document.getElementById('output');

    // ç‚¹å‡»æŒ‰é’®ç«‹å³æ¸…ç©ºè¾“å‡º
    outText.value='';
    outPrefix.value='HT-';

    let flashColor=operation==='encrypt'?'#4cafef33':'#ff704333';
    flashContainer(flashColor);

    let result='';
    if(mode==='ADM'){
        if(operation==='encrypt'){
            if(!/^\d{8}$/.test(prefix) || !prefix.startsWith('7688')){
                alert('å‰ç¼€å¿…é¡»8ä½æ•°å­—ä¸”ä»¥7688å¼€å¤´'); return;
            }
            if(!/^\d{4}$/.test(main)){alert('å³ä¾§è¾“å…¥å¿…é¡»4ä½æ•°å­—'); return;}
            result=encryptADM(prefix,main);
        }else{
            if(!/^[2-9A-HJ-NP-Z]{6}$/.test(main)){alert('å³ä¾§è¾“å…¥å¿…é¡»6ä½é˜²å‘†å­—ç¬¦'); return;}
            result=decryptADM(main,'7688'+'0000'); //ç®€åŒ–æµ‹è¯•
        }
    }

    outText.value=result;

    // log
    const log=document.getElementById('log');
    const time=new Date().toLocaleTimeString();
    log.innerHTML=`<div>[${time}] æ¨¡å¼:${mode} æ“ä½œ:${operation} è¾“å…¥:${prefix}+${main} â†’ è¾“å‡º:${result}</div>`+log.innerHTML;
}
</script>
</body>
</html>
